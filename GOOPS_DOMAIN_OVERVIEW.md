# نمای کلی دامنه بیزنسی گُوپس (GOOPS Domain Overview)

## توصیف بیزنس
گُوپس یک پلتفرم «غذای خانگی» است که مامان‌ها (آشپزهای خانگی) را به مشتریان شهری متصل می‌کند. هسته سیستم از محصول Karenderia مشتق شده اما با نیازهای بازار ایران (واحد پول تومان، تاریخ شمسی، نقشه داخلی و درگاه‌های پرداخت بومی) تطبیق داده می‌شود. چرخه ارزش شامل ثبت‌نام مامان، تعریف منوی خانگی، سفارش مشتری، آماده‌سازی، تحویل توسط راننده و دریافت بازخورد است.

## نقش‌ها و ارتباط آن‌ها با سیستم
- **مامان (Merchant):** تولیدکننده اصلی محتوا (منو، قیمت، زمان‌بندی) و مسئول مدیریت سفارش‌ها. در وب از طریق پنل `backoffice/merchant` و در موبایل با اپ Quasar (`MerchantVue`) فعالیت می‌کند.
- **مشتری (Customer):** مصرف‌کننده نهایی. با اپ Quasar (`MobileVue`) یا نسخه وب SPA کار می‌کند؛ سفارش را ثبت، پرداخت و پیگیری می‌کند.
- **ادمین (Platform Admin):** در پنل `backoffice/` با ابزارهای Yii، مامان‌ها را تایید، گزارش‌ها را بررسی و تنظیمات پرداخت/نقشه/اعلان را مدیریت می‌کند.
- **راننده (Driver):** مأمور تحویل؛ از اپ Quasar (`DriverVue`) برای دریافت وظایف، ثبت موقعیت زنده و به‌روزرسانی وضعیت تحویل استفاده می‌کند.
- **پشتیبان/کیچن:** اپ KDS (`KicthenMobile`) برای نمایش سفارش در آشپزخانه و هماهنگی با مامان و راننده.
- **سیستم‌های خارجی:** درگاه‌های پرداخت بین‌المللی، سرویس نقشه، Firebase/Pusher برای اعلان، Twilio/Nexmo برای پیامک و سرویس‌های ورود اجتماعی.

## جریان‌های اصلی
### ۱. جریان مشتری
1. **ثبت‌نام/ورود:** از طریق اپ Quasar (`MobileVue`)، درخواست‌ها به `ApiController` ارسال می‌شود که احراز هویت را مدیریت می‌کند.
2. **کاوش و انتخاب:** لیست مامان‌ها و آیتم‌ها از API فراخوانی می‌شود؛ نقشه Google (`vue3-google-map`) مکان مامان‌ها را نمایش می‌دهد.
3. **افزودن به سبد و زمان‌بندی:** مشتری آیتم‌ها را انتخاب، زمان تحویل را تنظیم و آدرس را روی نقشه تایید می‌کند.
4. **پرداخت:** ماژول‌های پرداخت هسته (Stripe/PayPal/Razorpay و نسخه بومی زرین‌پال) از طریق API در دسترس قرار می‌گیرند؛ نتیجه پرداخت به سفارش مرتبط می‌شود.
5. **پیگیری سفارش:** وضعیت سفارش با Pusher/Firebase به‌روز می‌شود؛ مشتری می‌تواند رهگیری راننده و تاریخچه سفارش را مشاهده کند.

### ۲. جریان مامان
1. **آن‌بردینگ:** مامان از طریق پنل وب یا اپ ثبت‌نام می‌کند، پلن اشتراک را انتخاب و مدارک را ارسال می‌کند.
2. **تعریف منو و ظرفیت:** فرم‌های پنل `backoffice/merchant` یا اپ `MerchantVue` امکان تعریف آیتم، قیمت، ظرفیت روزانه و تصاویر را می‌دهند.
3. **دریافت سفارش:** اعلان‌های بلادرنگ (Push/Firebase) و داشبورد سفارش، ورودی‌های جدید را نمایش می‌دهد.
4. **آماده‌سازی و تحویل:** مامان وضعیت را به «در حال آماده‌سازی» تغییر می‌دهد، برای بسته‌بندی از KDS استفاده کرده و سفارش را به راننده تحویل می‌دهد.
5. **گزارش و مالی:** بخش‌های گزارش فروش، کمیسیون و موجودی به تومان تنظیم شده‌اند؛ مامان می‌تواند تسویه‌حساب درخواست کند.

### ۳. جریان ادمین
1. **مدیریت کاربران:** بررسی درخواست‌های مامان، تایید یا رد، تنظیم نقش‌ها و محدودیت‌ها.
2. **پیکربندی سیستم:** مدیریت کلیدهای API (نقشه، پرداخت، پیامک)، تعیین پارامترهای کمیسیون، زمان‌بندی سفارش و پیامک‌های سیستم.
3. **نظارت و گزارش:** داشبوردها فروش، سفارش‌ها، لاگ پرداخت و وضعیت رانندگان را ارائه می‌دهند؛ مرتب‌سازی تاریخ باید با تبدیل شمسی/میلادی هماهنگ شود.
4. **پشتیبانی:** ادمین می‌تواند سفارش‌ها را ویرایش، سفارش جایگزین ثبت و پیام به مشتری/مامان ارسال کند (از طریق SMS/Push).

### ۴. جریان راننده
1. **لاگین و دریافت وظایف:** اپ `DriverVue` با API ارتباط دارد و وظایف روزانه را واکشی می‌کند.
2. **پذیرش و رهگیری:** پس از پذیرش سفارش، موقعیت لحظه‌ای راننده از طریق Firebase به مشتری و مامان ارسال می‌شود.
3. **تحویل و تایید:** راننده با بروزرسانی وضعیت به «تحویل شد» چرخه را تکمیل و می‌تواند امضا/عکس بارگذاری کند.

### ۵. جریان پشتیبان آشپزخانه (KDS)
1. **دریافت سفارش:** نمایش سفارش‌های جدید در اپ KDS با اعلان بلادرنگ.
2. **اولویت‌بندی و تکمیل:** وضعیت آماده‌سازی تغییر می‌کند تا مامان و راننده در جریان قرار گیرند.
3. **چاپ و بسته‌بندی:** با اتصال به پرینتر حرارتی بلوتوث، رسید آشپزخانه چاپ می‌شود.

## نقاط اتصال مشترک
- تمام اپلیکیشن‌های Quasar از یک API مشترک (`protected/controllers/ApiController.php`) استفاده می‌کنند و با استاندارد JWT/Token کار می‌کنند.
- Push و پیامک توسط هسته PHP (Twilio/Nexmo) و پیکربندی‌های realtime (`SiteCommon`, `CSMSsender`) مدیریت می‌شود.
- ساختار دیتابیس مشترک (`karenderia.sql`) تضمین می‌کند که موجودی (`stock`)، سفارش و لاجستیک بین نقش‌ها به اشتراک گذاشته می‌شود.

## ملاحظات بومی‌سازی ایران
- جایگزینی سرویس‌های نقشه و پیامک با ارائه‌دهندگان داخلی و تضمین دسترسی پایدار.
- تطبیق متون و فرایندها با فرهنگ مخاطب ایرانی (مامان‌ها و مشتریان محلی).
- رسیدگی به قوانین مالی/مالیاتی (گزارش فروش، کمیسیون، درگاه‌های مجاز).
- پشتیبانی از تاریخ شمسی و واحد پول تومان در همه گزارش‌ها و اعلان‌ها.

const quasarComponents={empty(e){if(typeof e==="undefined"||e===null||e===""||e==="null"||e==="undefined"){return true}return false},setStorage(e,t){try{Quasar.LocalStorage.set(e,t)}catch(a){console.debug(a)}},getStorage(e){return Quasar.LocalStorage.getItem(e)},notify(e,t,a,s,r,o,i){if(typeof s!=="undefined"&&s!==null){}else{s="bottom"}if(typeof r!=="undefined"&&r!==null){}else{r=3e3}if(typeof o!=="undefined"&&o!==null){}else{o=e}if(typeof i!=="undefined"&&i!==null){}else{i=[]}const n=Quasar.Notify;n.create({message:t,color:e,icon:a,iconColor:o,classes:"primevue_toats",position:s,html:true,timeout:r,multiLine:false,actions:i})},dialog(e){const t=Quasar.Dialog;const a=t.create({message:e,progress:true,persistent:true,ok:false,html:true});return a}};const headerAuthorization={headers:{Authorization:`token ${token}`}};const ComponentsMoney={props:["amount"],data(){return{data:0,config:JSON.parse(money_config)}},mounted(){this.data=window["v-money3"].format(this.amount,this.config)},updated(){this.data=window["v-money3"].format(this.amount,this.config)},methods:{formatNumber(e){return window["v-money3"].format(e,this.config)}},template:`	
    {{data}}
    `};const translationVendor=!quasarComponents.empty(translation_vendor)?JSON.parse(translation_vendor):null;const ComponentsSearchcustomer={props:["default_list"],data(){return{customer_name:"",loading:false,old_search:"",options:[]}},watch:{default_list(){this.options=this.default_list}},methods:{setModel(e){this.customer_name=e},Clear(){console.log("Clear")},searchCustomer(e,t,a){if(e.length<2){if(!quasarComponents.empty(this.customer_name)){t(()=>{});return}this.old_search="";this.loading=false;t(()=>{});return}if(this.loading==e){t(()=>{})}this.loading=true;setTimeout(()=>{t(()=>{this.options=[];axios({method:"GET",url:pos_api+"/searchCustomer?language="+language+"&q="+e,data:{},headers:{Authorization:`token ${token}`}}).then(e=>{if(e.data.code==1){this.options=e.data.details.data}else{this.options=[]}})["catch"](e=>{}).then(e=>{this.loading=false})})},300)},Clear(){this.customer_name="";this.$emit("clearSelectcustomer");let e="cart_uuid="+quasarComponents.getStorage("pos_cart_uuid");axios.post(pos_api+"/clearCustomer?language="+language,e,headerAuthorization).then(e=>{})["catch"](e=>{console.error("Error:",e)}).then(e=>{})},onSelect(t){if(!quasarComponents.empty(t)){console.log("onSelect",t.value);this.$emit("onselectCustomer",t.value);let e="client_id="+t.value+"&cart_uuid="+quasarComponents.getStorage("pos_cart_uuid");axios.post(pos_api+"/cartSetCustomer?language="+language,e,headerAuthorization).then(e=>{if(e.data.code==1){this.$emit("afterSelectcustomer",{id:t.value,data:t})}})["catch"](e=>{console.error("Error:",e)}).then(e=>{})}}},template:"#xtemplate_search_customer"};const ComponentsCustomer={template:"#xtemplate_customer",data(){return{modal:false,first_name:"",last_name:"",email_address:"",contact_number:"",loading:false}},methods:{onSubmit(e){this.loading=true;let t="first_name="+this.first_name;t+="&last_name="+this.last_name;t+="&email_address="+this.email_address;t+="&contact_number="+this.contact_number;axios.post(pos_api+"/createCustomer?language="+language,t,{headers:{Authorization:`token ${token}`}}).then(e=>{if(e.data.code==1){this.modal=false;this.$emit("afterCreatecustomer",{id:e.data.details.client_id,data:{label:e.data.details.client_name,value:e.data.details.client_id}})}else{quasarComponents.notify("myerror",e.data.msg,"error")}})["catch"](e=>{console.error("Error:",e)}).then(e=>{this.loading=false})}}};const ComponentsItemdetails={template:"#xtemplate_item_details",props:["transaction_type","edit_cart","customer_id"],components:{"money-format":ComponentsMoney},data(){return{dialog:false,size:"",with_qty:false,qty:1,item_qty:1,morphGroupModel:"add",item_data:[],cat_id:0,item_uuid:"",loading:false,loading_add:false,items:[],item_size_id:0,size_data:[],size_datas:[],cooking_ref:0,cooking_data:[],ingredients:[],ingredients_data:[],addons:{},special_instructions:"",if_sold_out:"",sold_out_options:[],item_total:0,disabled_cart:true,slide_items:0,favorites:[],number_config:[],meta:[],items_not_available:[],category_not_available:[],deep_link:"",show_nav:false,item_gallery:[],image_featured:"",points_data:null}},watch:{addons:{handler(e,t){this.ItemSummary()},deep:true},item_size_id(){this.ItemSummary()},cooking_ref(){this.ItemSummary()},ingredients(){this.ItemSummary()},item_qty(){this.ItemSummary()}},methods:{resetData(){this.item_qty=1;this.items=[];this.item_size_id=0;this.size_data=[];this.size_datas=[];this.cooking_ref=0;this.cooking_data=[];this.ingredients=[];this.ingredients_data=[];this.addons={};this.special_instructions="";this.if_sold_out="";this.sold_out_options=[];this.item_total=0;this.disabled_cart=true;this.slide_items=0},getMenuItem(){this.loading=true;this.$emit("itemShow");this.resetData();let e="cat_id="+this.item_data.cat_id;e+="&item_uuid="+this.item_data.item_uuid;e+="&customer_id="+this.customer_id;axios.post(pos_api+"/getMenuItem?language="+language,e,{headers:{Authorization:`token ${token}`}}).then(e=>{let t=e.data;if(e.data.code==1){this.items=t.details.data.items;this.meta=t.details.data.meta;this.size_datas=t.details.data.items.price;const a=t.details.sold_out_options;this.if_sold_out=t.details.default_sold_out_options;this.items_not_available=t.details.data.items_not_available;this.category_not_available=t.details.data.category_not_available;this.points_data=t.details.points;const s=t.details.data.items.price;const r=t.details.data.meta?t.details.data.meta.cooking_ref:{};const o=t.details.data.meta?t.details.data.meta_details.cooking_ref:{};const i=t.details.data.meta?t.details.data.meta.ingredients:{};const n=t.details.data.meta?t.details.data.meta_details.ingredients:{};const l=t.details.data?t.details.data.addons:{};const d=t.details.data?t.details.data.addon_items:{};if(Object.keys(a).length>0){Object.entries(a).forEach(([e,t])=>{this.sold_out_options.push({label:t,value:e})})}if(Object.keys(s).length>0){Object.entries(s).forEach(([e,t])=>{if(t.discount<=0){this.size_data.push({label:t.size_name+" "+t.pretty_price,value:parseInt(t.item_size_id)})}else{this.size_data.push({label:t.size_name+" "+t.pretty_price_after_discount,value:parseInt(t.item_size_id)})}});this.item_size_id=parseInt(Object.keys(s)[0])}if(typeof r!=="undefined"&&r!==null){if(r.length>0){Object.entries(r).forEach(([e,t])=>{this.cooking_data.push({label:o[t].meta_name,value:o[t].meta_id})})}}if(typeof i!=="undefined"&&i!==null){if(i.length>0){Object.entries(i).forEach(([e,t])=>{if(n[t]){this.ingredients_data.push({label:n[t].meta_name,value:n[t].meta_id})}if(this.items.ingredients_preselected){if(n[t]){this.ingredients.push(n[t].meta_id)}}})}}if(Object.keys(this.items.item_addons).length>0){Object.entries(this.items.item_addons).forEach(([o,e])=>{const i=[];Object.entries(e).forEach(([e,t])=>{if(!quasarComponents.empty(l[o])){if(!quasarComponents.empty(l[o][t])){const a=l[o][t];const s=[];Object.entries(a.sub_items).forEach(([e,t])=>{if(d[t]){const a=d[t];d[t].checked=false;d[t].disabled=false;d[t].qty=1;s.push(a)}});const r={subcat_id:a.subcat_id,subcategory_name:a.subcategory_name,subcategory_description:a.subcategory_description,multi_option:a.multi_option,multi_option_min:a.multi_option_min,multi_option_value:a.multi_option_value,require_addon:a.require_addon,pre_selected:a.pre_selected,sub_items_checked:"",sub_items:s};i.push(r)}}});this.addons[o]=i})}}else{this.resetData()}})["catch"](e=>{console.error("Error:",e)}).then(e=>{this.loading=false})},beforeHide(){this.qty=1;this.$emit("itemHide")},ItemSummary(){let d=0;const e=[];const c=[];let h=[];let u=[];if(!quasarComponents.empty(this.size_datas[this.item_size_id])){const t=this.size_datas[this.item_size_id];if(t.discount>0){d+=this.item_qty*parseFloat(t.price_after_discount)}else d+=this.item_qty*parseFloat(t.price)}if(!quasarComponents.empty(this.addons[this.item_size_id])){this.addons[this.item_size_id].forEach((s,a)=>{if(s.require_addon==="1"){e.push(s.subcat_id)}if(s.multi_option==="custom"){let a=0;const i=s.multi_option_value;let e=s.multi_option_min;if(i>0){h.push({subcat_id:s.subcat_id,min:e,max:i})}const n=[];const l=[];s.sub_items.forEach((e,t)=>{if(e.checked===true){a++;d+=this.item_qty*parseFloat(e.price);c.push(s.subcat_id)}else n.push(t);if(e.disabled===true){l.push(t)}});u[s.subcat_id]={total:a};if(a>=i){n.forEach((e,t)=>{s.sub_items[e].disabled=true})}else{l.forEach((e,t)=>{s.sub_items[e].disabled=false})}}else if(s.multi_option==="one"){s.sub_items.forEach((e,t)=>{if(e.sub_item_id===s.sub_items_checked){d+=this.item_qty*parseFloat(e.price);c.push(s.subcat_id)}})}else if(s.multi_option==="multiple"){var r=[];let e=s.multi_option_min;var t=s.multi_option_value;var o=0;if(t>0){h.push({subcat_id:s.subcat_id,min:e,max:t})}s.sub_items.forEach((e,t)=>{if(e.checked===true){d+=e.qty*parseFloat(e.price);c.push(s.subcat_id);o+=e.qty}r.push(t)});u[s.subcat_id]={total:o};this.addons[this.item_size_id][a].qty_selected=o;if(this.addons[this.item_size_id][a].qty_selected>=t){r.forEach((e,t)=>{this.addons[this.item_size_id][a].sub_items[e].disabled=true})}else{r.forEach((e,t)=>{this.addons[this.item_size_id][a].sub_items[e].disabled=false})}}})}if(d>0){this.item_total=d}let r=true;if(e.length>0){e.forEach((e,t)=>{if(c.includes(e)===false){r=false;return false}})}if(this.items.cooking_ref_required){let e=false;if(this.cooking_ref>0){e=true}if(!e){r=false}}if(Object.keys(h).length>0){let a,s;Object.entries(h).forEach(([e,t])=>{a=parseInt(t.min);if(u[t.subcat_id]){s=parseInt(u[t.subcat_id].total)}if(s>0){if(a>s){r=false}}})}if(r){this.disabled_cart=false}else this.disabled_cart=true;if(this.items.cooking_ref_required){let e=false;if(this.cooking_ref>0){e=true}if(!e){r=false}}if(Object.keys(h).length>0){let a,s;Object.entries(h).forEach(([e,t])=>{a=parseInt(t.min);if(u[t.subcat_id]){s=parseInt(u[t.subcat_id].total)}if(s>0){if(a>s){r=false}}})}if(r){this.disabled_cart=false}else this.disabled_cart=true;if(this.items.cooking_ref_required){let e=false;if(this.cooking_ref>0){e=true}if(!e){r=false}}if(Object.keys(h).length>0){let a,s;Object.entries(h).forEach(([e,t])=>{a=parseInt(t.min);if(u[t.subcat_id]){s=parseInt(u[t.subcat_id].total)}if(s>0){if(a>s){r=false}}})}if(r){this.disabled_cart=false}else this.disabled_cart=true},AddToCart(){const a=[];if(this.ingredients.length>0){this.ingredients.forEach((e,t)=>{a.push({meta_id:e,checked:true,meta_name:""})})}const e={cooking_ref:[{meta_id:this.cooking_ref,checked:this.cooking_ref,meta_name:""}],ingredients:a};const t=quasarComponents.getStorage("pos_cart_uuid");const s={cart_uuid:t,cat_id:this.item_data.cat_id,item_size_id:this.item_size_id,item_token:this.item_data.item_uuid,item_qty:this.item_qty,special_instructions:this.special_instructions,if_sold_out:this.if_sold_out.value,transaction_type:this.transaction_type,meta:e,item_addons:!quasarComponents.empty(this.addons[this.item_size_id])?this.addons[this.item_size_id]:[],edit_cart:this.edit_cart?this.edit_cart:false};this.loading_add=true;axios.post(pos_api+"/addCartItems",s,{headers:{Authorization:`token ${token}`}}).then(e=>{if(e.data.code==1){if(quasarComponents.empty(t)){quasarComponents.setStorage("pos_cart_uuid",e.data.details.cart_uuid)}this.dialog=false;this.$emit("afterAddtocart")}else{quasarComponents.notify("myerror",e.data.msg,"error")}})["catch"](e=>{console.error("Error:",e)}).then(e=>{this.loading_add=false})}}};const ComponentsAddressList={template:"#xtemplate_address_list",props:["client_id"],data(){return{dialog:false,loading:false,data:[]}},computed:{hasData(){if(Object.keys(this.data).length>0){return true}return false}},methods:{beforeHide(){this.data=[]},clientAddresses(){if(this.client_id=="walkin"){return false}this.loading=true;axios({method:"GET",url:pos_api+"/clientAddresses?language="+language+"&client_id="+this.client_id,data:{},headers:{Authorization:`token ${token}`}}).then(e=>{if(e.data.code==1){this.data=e.data.details.addresses}else{this.data=[]}})["catch"](e=>{}).then(e=>{this.loading=false})},showNewaddress(){this.dialog=false;this.$emit("showNewaddress")},setAddress(t){const a=quasarComponents.dialog(translationVendor.processing+"<br/>"+translationVendor.close_window);let e={cart_uuid:quasarComponents.getStorage("pos_cart_uuid"),data:t};axios.post(pos_api+"/saveaddress?language="+language,e,headerAuthorization).then(e=>{quasarComponents.setStorage("pos_address",t);quasarComponents.setStorage("pos_local_id",t.place_id);this.dialog=false;this.$emit("afterSelectaddress",t)})["catch"](e=>{}).then(e=>{a.hide()})}}};const ComponentsSearchAddress={props:["placeholder"],data(){return{address:"",address_data:[],options:[],data:[],loading:false}},methods:{Focus(){this.$refs.select_address.focus()},filterFn(t,e,a){if(t.length<2){a();return}setTimeout(()=>{e(()=>{this.options=[];let e="q="+t;axios.post(pos_api+"/getlocationAutocomplete?language="+language,e,headerAuthorization).then(e=>{this.options=e.data.details.data})["catch"](e=>{console.error("Error:",e)}).then(e=>{})})},300)},selectAddress(t){if(!quasarComponents.empty(t)){this.address_data=t;this.address=t.description;let e="place_id="+t.id;axios.post(pos_api+"/getLocationDetails?language="+language,e,headerAuthorization).then(e=>{if(e.data.code==1){const t=e.data.details.data;if(!quasarComponents.empty(t.latitude)){this.$emit("afterSelectaddress",t)}}})["catch"](e=>{console.error("Error:",e)}).then(e=>{})}}},template:`
	<q-select
    v-model="address"
    ref="select_address"
	use-input
	hide-selected
	fill-input
	input-debounce="0"
	:options="options"
	@filter="filterFn"
	@update:model-value="selectAddress"
	@input-value="setModel"
	@clear="$emit('onClear')"
	hide-dropdown-icon
	:loading="loading_search"
	outlined		
	clearable
	clear-icon="cancel"
	:placeholder="placeholder"
	stack-label
	color="grey-5"
  >
    <template v-slot:option="scope">
      <q-item v-bind="scope.itemProps">
        <q-item-section avatar top style="min-width: auto">
          <q-icon name="las la-map-marker" />
        </q-item-section>
        <q-item-section>
          <q-item-label>{{ scope.opt.description }}</q-item-label>
          <q-item-label caption>{{ scope.opt.addressLine2 }}</q-item-label>
        </q-item-section>
      </q-item>
    </template>    
  </q-select>
	`};const ComponentsMaps={props:["keys","provider","zoom","center","markers","size"],template:`     	
    <div ref="cmaps" class="map" :class="size">	
	</div>  	
    `,data(){return{cmapsMarker:[],latLng:[],cmaps:undefined,bounds:undefined}},mounted(){this.renderMap()},watch:{markers(e,t){this.renderMap()}},methods:{renderMap(){try{switch(this.provider){case"google.maps":this.bounds=new window.google.maps.LatLngBounds;if(typeof this.cmaps!=="undefined"&&this.cmaps!==null&&Object.keys(this.cmapsMarker).length>0){this.moveAllMarker()}else{this.cmaps=new window.google.maps.Map(this.$refs.cmaps,{center:{lat:parseFloat(this.center.lat),lng:parseFloat(this.center.lng)},zoom:parseInt(this.zoom),disableDefaultUI:true});Object.entries(this.markers).forEach(([e,t])=>{this.addMarker({position:{lat:parseFloat(t.lat),lng:parseFloat(t.lng)},map:this.cmaps,draggable:t.draggable==1?true:false,label:t.label},t.id,t.draggable)})}break;case"mapbox":if(typeof this.cmaps!=="undefined"&&this.cmaps!==null&&Object.keys(this.cmapsMarker).length>0){this.moveAllMarker()}else{mapboxgl.accessToken=this.keys;this.bounds=new mapboxgl.LngLatBounds;this.cmaps=new mapboxgl.Map({container:this.$refs.cmaps,style:"mapbox://styles/mapbox/streets-v12",center:[parseFloat(this.center.lng),parseFloat(this.center.lat)],zoom:14});this.cmaps.on("error",e=>{dump(e.error.message)});Object.entries(this.markers).forEach(([e,t])=>{this.addMarker({position:{lat:parseFloat(t.lat),lng:parseFloat(t.lng)},map:this.cmaps,draggable:t.draggable==1?true:false},t.id,t.draggable)});this.FitBounds()}break}}catch(e){console.error(e)}},addMarker(e,a,t){try{switch(this.provider){case"google.maps":this.cmapsMarker[a]=new window.google.maps.Marker(e);this.cmaps.panTo(new window.google.maps.LatLng(e.position.lat,e.position.lng));this.bounds.extend(this.cmapsMarker[a].position);if(t===true){window.google.maps.event.addListener(this.cmapsMarker[a],"drag",e=>{this.$emit("dragMarker",true)});window.google.maps.event.addListener(this.cmapsMarker[a],"dragend",e=>{const t=e.latLng;this.latLng={lat:t.lat(),lng:t.lng()};this.$emit("dragMarker",false);this.$emit("afterSelectmap",t.lat(),t.lng())})}break;case"mapbox":this.cmapsMarker[a]=new mapboxgl.Marker(e).setLngLat([e.position.lng,e.position.lat]).addTo(this.cmaps);this.bounds.extend(new mapboxgl.LngLat(e.position.lng,e.position.lat));if(t===true){this.cmapsMarker[a].on("dragend",e=>{const t=this.cmapsMarker[a].getLngLat();dump(t.lat+"=>"+t.lng);this.$emit("afterSelectmap",t.lat,t.lng)});this.mapBoxResize()}break}}catch(s){console.error(s)}},mapBoxResize(){if(this.provider=="mapbox"){setTimeout(()=>{this.cmaps.resize()},500)}},moveAllMarker(){console.log("moveAllMarker");console.log(this.markers);if(this.provider=="google.maps"){if(Object.keys(this.markers).length>0){Object.entries(this.markers).forEach(([e,t])=>{let a=new google.maps.LatLng(parseFloat(t.lat),parseFloat(t.lng));if(!quasarComponents.empty(this.cmapsMarker[t.id])){this.cmapsMarker[t.id].setPosition(a)}});if(Object.keys(this.markers).length>1){this.FitBounds()}else{this.cmaps.panTo(new window.google.maps.LatLng(this.markers[0].lat,this.markers[0].lng))}}}else{if(Object.keys(this.markers).length>0){Object.entries(this.markers).forEach(([e,t])=>{if(!quasarComponents.empty(this.cmapsMarker[t.id])){this.cmapsMarker[t.id].setLngLat([t.lng,t.lat]).addTo(this.cmaps)}});if(Object.keys(this.markers).length>1){this.FitBounds()}else{this.cmaps.flyTo({center:[this.markers[0].lng,this.markers[0].lat],essential:true,zoom:14})}}}},centerMap(){this.FitBounds()},FitBounds(){try{switch(this.provider){case"google.maps":if(!quasarComponents.empty(this.bounds)){this.cmaps.fitBounds(this.bounds)}break;case"mapbox":if(!quasarComponents.empty(this.bounds)){this.cmaps.fitBounds(this.bounds,{duration:0,padding:50})}break}}catch(e){}},setCenter(e,t){try{switch(this.provider){case"google.maps":this.cmaps.setCenter(new window.google.maps.LatLng(e,t));break;case"mapbox":this.cmaps.flyTo({center:[t,e],essential:true});break}}catch(a){console.error(a)}},setPlusZoom(){dump("setPlusZoom");this.cmaps.setZoom(this.cmaps.getZoom()+2)},setLessZoom(){dump("setLessZoom");this.cmaps.setZoom(this.cmaps.getZoom()-2)}}};const ComponentsNewaddress={template:"#xtemplate_new_address",props:["client_id","attributes_data"],components:{SearchAddress:ComponentsSearchAddress,"components-maps":ComponentsMaps},data(){return{data:[],center:{lat:34.04703,lng:-118.24686},marker_position:{},modal:false,loading:false,formatted_address:"",address1:"",location_name:"",delivery_options:"Leave it at my door",delivery_instructions:"",address_label:"Home",custom_field1:"",custom_field2:""}},created(){this.marker_position=[{id:0,lat:parseFloat(this.center.lat),lng:parseFloat(this.center.lng),draggable:true}]},computed:{hasAddress(){if(Object.keys(this.data).length>0){return true}return false},getMapsConfig(){if(Object.keys(this.attributes_data).length>0){return this.attributes_data.maps_config?this.attributes_data.maps_config:false}return false}},methods:{afterSelectaddress(e){console.log("afterSelectaddress xx",e);this.data=e;this.formatted_address=e.address.formatted_address;this.address1=e.address.address1;this.marker_position=[{id:0,lat:parseFloat(e.latitude),lng:parseFloat(e.longitude),draggable:true}]},dragMarker(){},afterSelectmap(e,t){this.loading=true;let a="&lat="+e+"&lng="+t;axios.post(pos_api+"/reverseGeocoding?language="+language,a,headerAuthorization).then(t=>{if(t.data.code==1){this.data=t.data.details.data;let e=this.data.parsed_address;this.formatted_address=this.data.address.formatted_address;this.address1=this.data.address.address1;this.data.latitude=this.data.latitude;this.data.longitude=this.data.longitude}else{quasarComponents.notify("myerror",t.data.msg,"error")}})["catch"](e=>{console.error("Error:",e)}).then(e=>{this.loading=false})},onClear(){this.data=[];this.formatted_address="";this.address1="";this.location_name="";this.delivery_instructions=""},onSubmit(){console.log("onSubmit");if(quasarComponents.empty(this.formatted_address)){quasarComponents.notify("myerror",translationVendor.enter_your_location,"error")}this.loading=true;let e={cart_uuid:quasarComponents.getStorage("pos_cart_uuid"),client_id:this.client_id,place_id:this.data.place_id,formatted_address:this.formatted_address,address1:this.address1,latitude:this.data.latitude,longitude:this.data.longitude,location_name:this.location_name,delivery_instructions:this.delivery_instructions,address_label:this.address_label,delivery_options:this.delivery_options,custom_field1:this.custom_field1,custom_field2:this.custom_field2,data:this.data};axios.post(pos_api+"/saveCartAddress?language="+language,e,headerAuthorization).then(e=>{if(e.data.code==1){this.data.attributes={location_name:this.location_name,delivery_options:this.delivery_options,delivery_instructions:this.delivery_instructions,address_label:this.address_label};quasarComponents.setStorage("pos_address",this.data);quasarComponents.setStorage("pos_local_id",this.data.place_id);this.modal=false;this.$emit("afterSaveaddress",this.data)}else{quasarComponents.notify("myerror",e.data.msg,"error")}})["catch"](e=>{console.error("Error:",e)}).then(e=>{this.loading=false})}}};const ComponentsDiscount={template:"#xtemplate_discount",props:["label","field_type","icon","filed_name","method_name","transaction_type"],data(){return{loading:false,modal:false,value:0}},methods:{beforeShow(){if(this.field_type=="number"){this.value=0}else this.value=""},OnShow(){console.log("OnShow");this.$refs.value.focus()},onSubmit(){this.loading=true;let e="cart_uuid="+quasarComponents.getStorage("pos_cart_uuid")+"&"+this.filed_name+"="+this.value;e+="&transaction_type="+this.transaction_type;axios.post(pos_api+"/"+this.method_name+"?language="+language,e,headerAuthorization).then(e=>{if(e.data.code==1){this.modal=false;this.$emit("refreshCart")}else{quasarComponents.notify("myerror",e.data.msg,"error")}})["catch"](e=>{console.error("Error:",e)}).then(e=>{this.loading=false})}}};const ComponentsPoints={template:"#xtemplate_points",props:["use_thresholds","client_id"],data(){return{loading:false,modal:false,points:0,points_tab:0,data_points:[],balance:0,points_id:0,available_points:0}},methods:{beforeShow(){this.points=0;this.available_points=0;if(this.use_thresholds){this.getPointsthresholds()}this.getAvailablepoints()},OnShow(){if(!this.use_thresholds){this.$refs.points.focus()}},getPointsthresholds(){this.loading=true;let e="customer_id="+this.client_id;axios.post(pos_api+"/getPointsthresholds?language="+language,e,headerAuthorization).then(e=>{if(e.data.code==1){this.data_points=e.data.details.data;this.balance=e.data.details.balance}else{quasarComponents.notify("myerror",e.data.msg,"error")}})["catch"](e=>{console.error("Error:",e)}).then(e=>{this.loading=false})},setPoints(){this.points=this.points_tab.points;this.points_id=this.points_tab.id},onSubmit(){this.loading=true;let e="cart_uuid="+quasarComponents.getStorage("pos_cart_uuid")+"&points="+this.points;e+="&customer_id="+this.client_id;e+="&points_id="+this.points_id;axios.post(pos_api+"/applyPoints?language="+language,e,headerAuthorization).then(e=>{if(e.data.code==1){this.modal=false;this.$emit("refreshCart")}else{quasarComponents.notify("myerror",e.data.msg,"error")}})["catch"](e=>{console.error("Error:",e)}).then(e=>{this.loading=false})},getAvailablepoints(){this.loading=true;let e="&customer_id="+this.client_id;axios.post(pos_api+"/getavailablepoints?language="+language,e,headerAuthorization).then(e=>{if(e.data.code==1){this.available_points=e.data.details.total}else{this.available_points=0}})["catch"](e=>{console.error("Error:",e)}).then(e=>{this.loading=false})}}};const ComponentsHoldorder={template:"#xtemplate_holdorder",data(){return{loading:false,modal:false,order_reference:""}},methods:{beforeShow(){this.order_reference=""},OnShow(){console.log("OnShow");this.$refs.order_reference.focus()},onSubmit(){this.loading=true;let e="cart_uuid="+quasarComponents.getStorage("pos_cart_uuid");e+="&order_reference="+this.order_reference;axios.post(pos_api+"/applyHoldOrder?language="+language,e,headerAuthorization).then(e=>{if(e.data.code==1){this.modal=false;quasarComponents.setStorage("pos_cart_uuid","");quasarComponents.setStorage("pos_local_id","");quasarComponents.setStorage("pos_address","");this.$emit("afterHoldcart",e.data.details)}else{quasarComponents.notify("myerror",e.data.msg,"error")}})["catch"](e=>{console.error("Error:",e)}).then(e=>{this.loading=false})}}};const ComponentsPayment={template:"#xtemplate_createpayment",props:["attributes_data","transaction_list","transaction_type","cart_total"],data(){return{loading:false,modal:false,whento_deliver:"now",delivery_date:"",delivery_time:"",order_status:"",receive_amount:0,payment_code:"",payment_reference:"",order_notes:"",pay_left:0,change:0,room_id:"",table_id:"",guest_number:1,total:0}},computed:{getOpeningDates(){let a=[];if(Object.keys(this.attributes_data).length>0){Object.entries(this.attributes_data.opening_hours.dates).forEach(([e,t])=>{a.push({label:t.name,value:t.value})});return a}return a},getTimelist(){if(Object.keys(this.attributes_data).length>0){if(!quasarComponents.empty(this.attributes_data.opening_hours.time_ranges[this.delivery_date])){return this.attributes_data.opening_hours.time_ranges[this.delivery_date]}}return[]},getOrderStatus(){if(Object.keys(this.attributes_data).length>0){return this.attributes_data.order_status_list}return[]},getPaymentMethod(){if(Object.keys(this.attributes_data).length>0){return this.attributes_data.data}return[]},getRoomList(){if(Object.keys(this.attributes_data).length>0){return this.attributes_data.room_list}return[]},getTableList(){if(Object.keys(this.attributes_data).length>0){if(this.attributes_data.table_list[this.room_id]){return this.attributes_data.table_list[this.room_id]}}return[]}},watch:{cart_total(e,t){this.receive_amount=e.raw;this.total=e.raw},receive_amount(e,t){this.pay_left=parseFloat(this.total)-parseFloat(e);if(this.pay_left<=0){this.pay_left=0}this.change=parseFloat(e)-parseFloat(this.total);if(this.change<=0){this.change=0}}},methods:{afterSelectRoom(){this.table_id=""},getCartUUID(){let e=quasarComponents.getStorage("pos_cart_uuid");return!quasarComponents.empty(e)?e:""},getLocalID(){let e=quasarComponents.getStorage("pos_local_id");return!quasarComponents.empty(e)?e:""},beforeShow(){if(Object.keys(this.attributes_data).length>0){this.order_status=this.attributes_data.order_status;this.payment_code=this.attributes_data.default_payment}},onSubmit(){let e={place_id:this.getLocalID(),place_data:quasarComponents.getStorage("pos_address"),cart_uuid:this.getCartUUID(),transaction_type:this.transaction_type,delivery_date:this.delivery_date,delivery_time:this.delivery_time,order_status:this.order_status,receive_amount:this.receive_amount,payment_code:this.payment_code,payment_reference:this.payment_reference,order_notes:this.order_notes,order_change:this.change,guest_number:this.guest_number,room_id:this.room_id,table_id:this.table_id};this.loading=true;axios.post(pos_api+"/submitPOSOrder?language="+language,e,headerAuthorization).then(e=>{if(e.data.code==1){this.modal=false;quasarComponents.notify("mysuccess",e.data.msg,"info");this.$emit("afterPayment",e.data.details)}else{quasarComponents.notify("myerror",e.data.msg,"error")}})["catch"](e=>{console.error("Error:",e)}).then(e=>{this.loading=false})}}};const ComponentsReceipt={template:"#xtemplate_receipt",data(){return{modal:false,loading:false,order_uuid:"",payload:["merchant_info","items","summary","order_info","status_allowed_cancelled","order_delivery_status"],merchant:[],order_info:[],order_items:[],order_summary:[],services:[],order_table_data:[],is_printing:false}},computed:{hasBooking(){if(Object.keys(this.order_table_data).length>0){return true}return false}},methods:{beforeShow(){this.orderDetails()},orderDetails(){this.loading=true;let e={order_uuid:this.order_uuid,payload:this.payload};axios.post(pos_api+"/orderDetails?language="+language,e,headerAuthorization).then(t=>{if(t.data.code==1){let e=t.data.details.data;this.merchant=e.merchant;this.order_info=e.order.order_info;this.order_items=e.items;this.order_summary=e.summary;this.services=e.order.services;this.order_table_data=e.order_table_data}else{quasarComponents.notify("myerror",t.data.msg,"error")}})["catch"](e=>{console.error("Error:",e)}).then(e=>{this.loading=false})},printReceipt(){this.is_printing=true;$(".printhis").printThis();setTimeout(()=>{this.is_printing=false},1e3)}}};const ComponentsSelectTable={template:"#xtemplate_select_table",props:["label"],data(){return{modal:false,loading:false,guest_number:0,guest_options:[],table_details:[]}},methods:{beforeShow(){console.log("table_details",this.table_details);this.guest_options=[];const t=parseInt(this.table_details.min_covers);const a=parseInt(this.table_details.max_covers);for(let e=t;e<=a;e++){this.guest_options.push({label:e,value:e})}this.guest_number=this.table_details?this.table_details.guest_number?this.table_details.guest_number:t:t},onSubmit(){this.loading=true;let e=quasarComponents.getStorage("pos_cart_uuid");let t="room_uuid="+this.table_details.room_uuid+"&table_uuid="+this.table_details.table_uuid;t+="&guest_number="+this.guest_number+"&cart_uuid="+e;axios.post(pos_api+"/saveguestnumber?language="+language,t,headerAuthorization).then(e=>{if(e.data.code==1){this.modal=false;this.$emit("afterAddguestnumber")}else{quasarComponents.notify("myerror",e.data.msg,"error")}})["catch"](e=>{console.error("Error:",e)}).then(e=>{this.loading=false})}}};const ComponentsMakepayment={template:"#xtemplate_makepayment",props:["title","attributes_data","transaction_type","cart_total","room_uuid","table_uuid","skip_kitchen","whento_deliver","delivery_date","delivery_time"],components:{"money-format":ComponentsMoney},data(){return{modal:false,status:"",payment_code:"",receive_amount:0,pay_left:0,change:0,payment_reference:"",order_notes:"",change_denomination:0,change_denomination_list:[],payment_icons:{cod:{bg:"bg-green",icon:"local_atm"},paypal:{bg:"bg-blue",icon:"credit_score"},stripe:{bg:"bg-blue-6",icon:"lab la-stripe"},razorpay:{bg:"bg-blue-10",icon:"credit_card"},mercadopago:{bg:"bg-light-blue-5",icon:"credit_card"},bank:{bg:"bg-blue-7",icon:"account_balance"},ocr:{bg:"bg-light-green",icon:"credit_card"},paydelivery:{bg:"bg-yellow-9",icon:"credit_card"}}}},computed:{getPaymentMethod(){if(Object.keys(this.attributes_data).length>0){return this.attributes_data.data}return[]},hasPaymentSelected(){if(this.payment_code){return true}return false},getOpeningDates(){let a=[];if(Object.keys(this.attributes_data).length>0){Object.entries(this.attributes_data.opening_hours.dates).forEach(([e,t])=>{a.push({label:t.name,value:t.value})});return a}return a},getTimelist(){if(Object.keys(this.attributes_data).length>0){if(!quasarComponents.empty(this.attributes_data.opening_hours.time_ranges[this.delivery_date])){return this.attributes_data.opening_hours.time_ranges[this.delivery_date]}}return[]},getOrderStatus(){if(Object.keys(this.attributes_data).length>0){return this.attributes_data.order_status_list}return[]}},watch:{receive_amount(e,t){this.pay_left=parseFloat(this.cart_total.raw)-parseFloat(e);if(isNaN(this.pay_left)){this.pay_left=0}else{this.pay_left=this.pay_left>0?this.pay_left:0}this.change=parseFloat(e)-parseFloat(this.cart_total.raw);if(isNaN(this.pay_left)){this.change=0}else{this.change=this.change>0?this.change:0}},change_denomination(e,t){this.receive_amount=e}},methods:{beforeShow(){this.receive_amount=0;this.payment_code="";this.generateDenomination()},getCartUUID(){let e=quasarComponents.getStorage("pos_cart_uuid");return!quasarComponents.empty(e)?e:""},getLocalID(){let e=quasarComponents.getStorage("pos_local_id");return!quasarComponents.empty(e)?e:""},setPaymenMethod(e){this.payment_code=e},getSelectedPayment(e){if(this.payment_code==e){return"table-waiting-for-bill"}return"table-occupied"},onSubmit(){const t=quasarComponents.dialog(translationVendor.payment_processing+"<br/>"+translationVendor.close_window);let e={place_id:this.getLocalID(),place_data:quasarComponents.getStorage("pos_address"),cart_uuid:this.getCartUUID(),whento_deliver:this.whento_deliver,transaction_type:this.transaction_type,delivery_date:this.delivery_date,delivery_time:this.delivery_time,order_status:this.status,receive_amount:this.receive_amount,payment_code:this.payment_code,payment_reference:this.payment_reference,order_notes:this.order_notes,order_change:this.change,room_id:this.room_uuid,table_id:this.table_uuid,skip_kitchen:this.skip_kitchen==true?1:0};this.loading=true;axios.post(pos_api+"/submitPOSOrder?language="+language,e,headerAuthorization).then(e=>{if(e.data.code==1){this.modal=false;this.$emit("afterPayment",e.data.details)}else{quasarComponents.notify("myerror",e.data.msg,"error")}})["catch"](e=>{console.error("Error:",e);quasarComponents.notify("myerror",e,"error")}).then(e=>{t.hide()})},generateDenomination(){const t=[];const a=10;const e=parseFloat(this.cart_total.raw);const s=Math.floor(e/a)*a;if(s<e){t.push({label:s,value:s})}t.push({label:e,value:e});let r=Math.ceil(e/a)*a;for(let e=0;e<5;e++){t.push({label:r,value:r});r+=a}this.change_denomination_list=t}}};const ComponentsElapsetime={props:["start","timezone"],data(){return{elapse:"",interval:undefined}},mounted(){if(!quasarComponents.empty(this.startElapse)){this.startElapse();this.interval=setInterval(this.startElapse,1e3)}},beforeUnmount(){clearInterval(this.interval)},methods:{startElapse(){if(typeof this.start!=="undefined"&&this.start!==null){}else{return""}const e=this.start;const t=this.timezone;const a=luxon.DateTime;const s=a.fromISO(e,{zone:t});const r=a.now().setZone(t);const o=r.diff(s).milliseconds;const i=Math.floor(o/1e3);const n=i%60;const l=Math.floor(i/60)%60;const d=Math.floor(i/(60*60))%24;const c=Math.floor(i/(60*60*24));if(l>0){if(c>0){this.elapse=`${c} days, ${d}:${l}:${n}`}else if(d>0){this.elapse=`${d}:${l}:${n}`}else{this.elapse=`${d}:${l}:${n}`}}else this.elapse=""}},template:`	
	<template v-if="elapse">
	   {{ elapse }}
	</template>
	`};{}const ComponentsOrders={template:"#xtemplate_orders",props:["transaction_list","transaction_type","title","printer_list"],components:{"components-elapsetime":ComponentsElapsetime},data(){return{proxy:false,data:[],order_type:[],loading:false,color_status:{delivery:"#388e3c",pickup:"#b2ebf2",dinein:"#ce93d8",takeout:"#90caf9"},columns:[{name:"item_name",field:"item_name",label:translationVendor.item,align:"left"},{name:"qty",field:"qty",label:translationVendor.qty},{name:"status",field:"status",label:translationVendor.status}],cart_uuid:null,socket_error:"",webSocket:null}},mounted(){this.getPOSorders(null)},computed:{hasFilter(){if(Object.keys(this.order_type).length>0){return true}return false},hasData(){if(Object.keys(this.data).length>0){return true}return false},hasPrinter(){if(Object.keys(this.printer_list).length>0){return true}return false}},methods:{getStatusClass(e){return"table-"+e},refreshData(){this.order_type=[];this.getPOSorders(true)},getPOSorders(e){if(e){console.log("refresh");this.$refs.bar.start()}else{this.loading=true}let t={order_type:this.order_type,transaction_type:this.transaction_type};axios.post(pos_api+"/getPOSorders?language="+language,t,headerAuthorization).then(e=>{if(e.data.code==1){this.data=e.data.details.data}else{this.data=[]}})["catch"](e=>{console.error("Error:",e)}).then(e=>{this.loading=false;this.$refs?.bar?.stop()})},applyFilters(){this.proxy=false;this.getPOSorders(true)},deleteConfirm(e,t){this.$q.dialog({title:translationVendor.confirm_deletion,message:translationVendor.delete_records_confirm,transitionShow:"fade",transitionHide:"fade",cancel:true,ok:{unelevated:true,color:"primary",rounded:true,"text-color":"white",size:"md",label:translationVendor.yes,"no-caps":true},cancel:{unelevated:true,color:"grey-5","text-color":"white",rounded:true,outline:false,size:"md",label:translationVendor.cancel,"no-caps":true}}).onOk(()=>{this.deleteOrders(e,t)})},deleteOrders(e,t){console.log("index",t);const a=quasarComponents.dialog(translationVendor.deleting_records);let s="cart_uuid="+e.cart_uuid;axios.post(pos_api+"/deleteOrders?language="+language,s,headerAuthorization).then(e=>{if(e.data.code==1){this.getPOSorders(true);console.log("deleteOrders");this.$emit("afterDeleteorders")}else{quasarComponents.notify("myerror",error,"error")}})["catch"](e=>{console.error("Error:",e)}).then(e=>{a.hide()})},getItemStatus(e){let t="";switch(e){case"in progress":t="orange-5";break;case"ready":t="light-green-3";break;case"delayed":t="red-7";break;case"cancelled":t="red";break;case"completed":t="green";break;default:t="primary";break}return t},SwitchPrinter(e,t,a){this.cart_uuid=e;if(a=="feieyun"){this.printUsingFP(t)}else{this.wifiPrint(t)}},printUsingFP(e){const t=quasarComponents.dialog(translationVendor.printing+"<br/>"+translationVendor.close_window);let a="printer_id="+e;a+="&cart_uuid="+this.cart_uuid;axios.post(pos_api+"/FPPrintOT?language="+language,a,headerAuthorization).then(e=>{if(e.data.code==1){this.modal=false;quasarComponents.notify("mysuccess",e.data.msg,"info")}else{quasarComponents.notify("myerror",e.data.msg,"error")}})["catch"](e=>{console.error("Error:",e)}).then(e=>{t.hide()})},wifiPrint(e){const t=quasarComponents.dialog(translationVendor.printing+"<br/>"+translationVendor.close_window);let a="printer_id="+e;a+="&cart_uuid="+this.cart_uuid;axios.post(pos_api+"/wifiPrintOT?language="+language,a,headerAuthorization).then(e=>{if(e.data.code==1){this.ConnectToPrintServer();setTimeout(()=>{this.sendServerToPrinter(e.data.details.data,e.data.msg)},500)}else{quasarComponents.notify("myerror",e.data.msg,"error")}})["catch"](e=>{console.error("Error:",e)}).then(e=>{t.hide()})},ConnectToPrintServer(){let e=!quasarComponents.empty(printerServer)?printerServer:null;if(this.webSocket==null){console.log("CONNECT ConnectToPrintServer");this.webSocket=new WebSocket(e);this.webSocket.onopen=function(e){console.log("WebSocket is open now.")};this.webSocket.onmessage=function(e){console.log("Received message from server:",e.data)};this.webSocket.onclose=function(e){console.log("WebSocket is closed now.");this.webSocket=null};this.webSocket.onerror=e=>{this.webSocket=null;this.socket_error=translationVendor.websocket_error;if(e instanceof ErrorEvent){this.socket_error=e.message}}}},sendServerToPrinter(e,t){if(this.webSocket.readyState===WebSocket.OPEN){this.webSocket.send(JSON.stringify(e));quasarComponents.notify("mysuccess",t,"info")}else{if(quasarComponents.empty(this.socket_error)){this.socket_error=translationVendor.websocket_is_not_open+this.webSocket.readyState}quasarComponents.notify("myerror",this.socket_error,"error")}}}};const ComponentsChooseReceipt={template:"#xchoose_receipt",props:["title","enabled_email","enabled_whatsapp","enabled_webprint","enabled_print","printer_list"],data(){return{modal:false,email_address:"",mobile_number:"",order_uuid:"",order_id:"",success_message:"",socket_error:"",webSocket:null}},computed:{ValidEmail(){const e=this.email_address;const t=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return t.test(e)},ValidMobileNumber(){const e=this.mobile_number;const t=/^\+?[0-9]{10,}$/;return t.test(e)},getPrinterList(){if(Object.keys(this.printer_list).length>0){return this.printer_list}return false}},methods:{isValidEmail(e){const t=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return t.test(e)},isValidMobileNumber(e){const t=/^\+?[0-9]{10,}$/;return t.test(e)},PrintWeb(){this.$emit("webPrint",this.order_uuid)},sendReceipt(e){const t=quasarComponents.dialog(translationVendor.sending_receipt+"<br/>"+translationVendor.close_window);let a="sending_type="+e+"&email_address="+this.email_address+"&mobile_number="+this.mobile_number;a+="&order_uuid="+this.order_uuid;axios.post(pos_api+"/sendReceipt?language="+language,a,headerAuthorization).then(e=>{if(e.data.code==1){this.modal=false;quasarComponents.notify("mysuccess",e.data.msg,"info")}else{quasarComponents.notify("myerror",e.data.msg,"error")}})["catch"](e=>{console.error("Error:",e)}).then(e=>{t.hide()})},SwitchPrinter(e,t){if(t=="feieyun"){this.printUsingThermal(e)}else{this.wifiPrint(e)}},printUsingThermal(e){const t=quasarComponents.dialog(translationVendor.printing+"<br/>"+translationVendor.close_window);let a="printer_id="+e;a+="&order_uuid="+this.order_uuid;axios.post(pos_api+"/printUsingThermal?language="+language,a,headerAuthorization).then(e=>{if(e.data.code==1){quasarComponents.notify("mysuccess",e.data.msg,"info")}else{quasarComponents.notify("myerror",e.data.msg,"error")}})["catch"](e=>{console.error("Error:",e)}).then(e=>{t.hide()})},wifiPrint(e){const t=quasarComponents.dialog(translationVendor.printing+"<br/>"+translationVendor.close_window);let a="printer_id="+e;a+="&order_uuid="+this.order_uuid;axios.post(pos_api+"/wifiPrint?language="+language,a,headerAuthorization).then(e=>{if(e.data.code==1){this.ConnectToPrintServer();setTimeout(()=>{this.sendServerToPrinter(e.data.details.data,e.data.msg)},500)}else{quasarComponents.notify("myerror",e.data.msg,"error")}})["catch"](e=>{console.error("Error:",e)}).then(e=>{t.hide()})},ConnectToPrintServer(){let e=!quasarComponents.empty(printerServer)?printerServer:null;if(this.webSocket==null){console.log("CONNECT ConnectToPrintServer");this.webSocket=new WebSocket(e);this.webSocket.onopen=function(e){console.log("WebSocket is open now.")};this.webSocket.onmessage=function(e){console.log("Received message from server:",e.data)};this.webSocket.onclose=function(e){console.log("WebSocket is closed now.");this.webSocket=null};this.webSocket.onerror=e=>{this.webSocket=null;this.socket_error=translationVendor.websocket_error;if(e instanceof ErrorEvent){this.socket_error=e.message}}}},sendServerToPrinter(e,t){if(this.webSocket.readyState===WebSocket.OPEN){this.webSocket.send(JSON.stringify(e));quasarComponents.notify("mysuccess",t,"info")}else{if(quasarComponents.empty(this.socket_error)){this.socket_error=translationVendor.websocket_is_not_open+this.webSocket.readyState}quasarComponents.notify("myerror",this.socket_error,"error")}}}};const ComponentsNotifications={template:"#xnotifications",props:["realtime_data","merchant_uuid"],data(){return{loading:false,count:0,data:[],pusher:null,channel:null}},mounted(){this.getNotifications();this.initPusher()},computed:{getData(){if(Object.keys(this.data).length>0){return this.data}return[]},hasData(){if(Object.keys(this.data).length>0){return true}return false}},methods:{initPusher(){if(Object.keys(this.realtime_data).length>0){console.log("realtime_data",this.realtime_data);Pusher.logToConsole=false;this.pusher=new Pusher(this.realtime_data.key,{cluster:this.realtime_data.cluster});this.channel=this.pusher.subscribe(this.merchant_uuid);this.channel.bind_global(this.handlePusherEvent)}},handlePusherEvent(e,t){console.log(`Received Pusher event '${e}':`,t);if(e!="pusher:subscription_succeeded"){this.count++;this.playAlert();const a={message:t.message,date:t.date};this.data.unshift(a);this.$emit("afterReceivenotification",t.meta_data);if(t.notification_type=="customer_request"){let e=t.message?t.message:"";e+="<br/>";e+=t.meta_data?t.meta_data?t.meta_data.title:"":"";quasarComponents.notify("occupied",e,"info","top-right",1e3*20,"dark",[{label:translationVendor.view,color:"blue","no-caps":true,handler:()=>{this.$emit("onAlertactions",t.meta_data)}}])}else{quasarComponents.notify("occupied",t.message,"info","top-right",1e3*20,"dark",[{label:"View",color:"blue","no-caps":true,handler:()=>{this.$emit("onAlertactions",t.meta_data)}}])}}},getNotifications(){this.loading=true;axios({method:"GET",url:pos_api+"/getNotifications?language="+language,data:{},headers:{Authorization:`token ${token}`}}).then(e=>{if(e.data.code==1){this.count=e.data.details.count;this.data=e.data.details.data}else{this.count=0;this.data=[]}})["catch"](e=>{}).then(e=>{this.loading=false})},playAlert(){this.player=new Howl({src:["../assets/sound/notify.mp3","../assets/sound/notify.ogg"],html5:true});this.player.play()},clearNotifications(){const t=quasarComponents.dialog(translationVendor.clear_notifications);axios({method:"GET",url:pos_api+"/clearNotifications?language="+language,data:{},headers:{Authorization:`token ${token}`}}).then(e=>{if(e.data.code==1){this.count=0;this.data=[]}})["catch"](e=>{}).then(e=>{t.hide()})}}};const ComponentsContinuesalert={props:["enabled_interval","interval_seconds"],data(){return{handle:undefined,loading:false}},created(){if(this.enabled_interval){this.getTableorder()}},methods:{startRequest(){if(this.handle){clearInterval(this.handle)}let e=3e4;if(typeof this.interval_seconds!=="undefined"&&this.interval_seconds!==null){e=parseFloat(this.interval_seconds)*1e3}this.handle=setInterval(()=>{this.getTableorder()},e)},getTableorder(){axios({method:"GET",url:pos_api+"/getTableneworder?language="+language,data:{},headers:{Authorization:`token ${token}`}}).then(e=>{if(e.data.code==1){Object.entries(e.data.details.data).forEach(([e,t])=>{console.log("items",t);if(e==0){this.playAlert();quasarComponents.notify("occupied",t.title+"<br/>"+t.message,"info","top-right",1e3*20,"dark",[{label:"View",color:"blue","no-caps":true,handler:()=>{this.$emit("onAlertactions",t.metadata)}}])}else{setTimeout(()=>{this.playAlert();quasarComponents.notify("occupied",t.title+"<br/>"+t.message,"info","top-right",1e3*20,"dark",[{label:"View",color:"blue","no-caps":true,handler:()=>{this.$emit("onAlertactions",t.metadata)}}])},1e3*2)}})}})["catch"](e=>{}).then(e=>{this.startRequest()})},playAlert(){this.player=new Howl({src:["../assets/sound/notify.mp3","../assets/sound/notify.ogg"],html5:true});this.player.play()}}};const ComponentsRequestitem={template:"#xrequest_item_details",data(){return{modal:false,table_uuid:"",request:[]}}};const ComponentsRequestList={template:"#xrequest_list",components:{"components-elapsetime":ComponentsElapsetime},data(){return{loading:false,data:null,field_data:{},selected_items:[],request_selected:[]}},mounted(){this.getCustomerRequest()},computed:{hasData(){if(this.data){if(Object.keys(this.data).length>0){return true}}return false}},methods:{hasValue(e){return this.data[e].items.some(e=>e.checked)},isLoading(e){return this.data[e]?this.data[e].loading:false},getCustomerRequest(){this.loading=true;axios({method:"GET",url:pos_api+"/getPendingRequestList?language="+language,headers:{Authorization:`token ${token}`}}).then(e=>{if(e.data.code==1){this.data=e.data.details.data}else{this.data=[]}})["catch"](e=>{}).then(e=>{this.loading=false})},setCompleted(e){const t=[];const a=this.data[e]?this.data[e]:null;if(a){a.items.forEach(e=>{if(e.checked){t.push(e.request_id)}});let e={request_id:t};a.loading=true;axios.post(pos_api+"/setRequestcompleted?language="+language,e,headerAuthorization).then(e=>{if(e.data.code==1){this.data=e.data.details.data}else{quasarComponents.notify("myerror",e.data.msg,"error")}})["catch"](e=>{console.error("Error:",e)}).then(e=>{a.loading=false})}}}};let html5QrCode=null;const ComponentsBarcode={template:"#xbarcode_template",props:["customer_id"],data(){return{modal:false,is_scan:false,html5QrCode:null,loading:false,scan_loading:false}},mounted(){},methods:{onBeforeshow(){},startScan(){this.is_scan=!this.is_scan;this.scan_loading=true;setTimeout(()=>{html5QrCode=new Html5Qrcode("reader");html5QrCode.start({facingMode:"environment"},{fps:10,qrbox:250},e=>{console.log("decodedText",e);this.findItemBarcode(e)},e=>{console.warn(e)}).then(()=>{this.scan_loading=false})["catch"](e=>{quasarComponents.notify("myerror",e,"error")})},500)},stopScan(){html5QrCode.stop().then(()=>{html5QrCode=null;this.is_scan=false})["catch"](e=>quasarComponents.notify("myerror",e,"error"))},onBeforehide(){if(this.is_scan){this.stopScan()}},findItemBarcode(e){this.loading=true;this.stopScan();let t={barcode:e,customer_id:this.customer_id};axios.post(pos_api+"/findItemBarcode?language="+language,new URLSearchParams(t).toString(),headerAuthorization).then(e=>{if(e.data.code==1){const t=e.data.details.data;this.$emit("afterScan",t);this.modal=false}else{quasarComponents.notify("myerror",e.data.msg,"error")}})["catch"](e=>{quasarComponents.notify("myerror",e,"error")}).then(e=>{this.loading=false})}}};const globalPrint={webSocket:null,socket_error:null,async ConnectToPrintServer(){let s=!quasarComponents.empty(printerServer)?printerServer:null;if(this.webSocket==null&&s){console.log("CONNECT ConnectToPrintServer");try{this.webSocket=await new Promise((e,t)=>{const a=new WebSocket(s);a.onopen=()=>{console.log("WebSocket is open now.");e(a)};a.onerror=e=>{console.error("WebSocket error",e);this.socket_error=translationVendor.websocket_error;if(e instanceof ErrorEvent){this.socket_error=e.message}t(e)};a.onmessage=e=>{console.log("Received message from server:",e.data)};a.onclose=()=>{console.log("WebSocket is closed now.");this.webSocket=null}});console.log("WebSocket connected and assigned.");return true}catch(error){console.warn("Failed to connect to WebSocket.");this.webSocket=null;return false}}return this.webSocket!==null},async sendServerToPrinter(e){if(this.webSocket&&this.webSocket.readyState===WebSocket.OPEN){try{this.webSocket.send(JSON.stringify(e));return true}catch(t){console.warn("Send failed:",t);return false}}else{console.warn("WebSocket is not connected.");return false}}};const app_pos=Vue.createApp({components:{"components-searchcustomer":ComponentsSearchcustomer,"components-customer":ComponentsCustomer,"components-item":ComponentsItemdetails,"components-addresslist":ComponentsAddressList,"components-newaddress":ComponentsNewaddress,"components-promo":ComponentsDiscount,"components-discount":ComponentsDiscount,"components-tips":ComponentsDiscount,"components-points":ComponentsPoints,"components-addtotal":ComponentsDiscount,"components-holdorder":ComponentsHoldorder,"components-payment":ComponentsPayment,"components-receipt":ComponentsReceipt,"components-selecttable":ComponentsSelectTable,"components-makepayment":ComponentsMakepayment,"components-orders":ComponentsOrders,"components-choose-receipt":ComponentsChooseReceipt,"components-notifications":ComponentsNotifications,"components-continuesalert":ComponentsContinuesalert,"components-requestitem":ComponentsRequestitem,"components-request-list":ComponentsRequestList,"components-elapsetime":ComponentsElapsetime,"components-barcode":ComponentsBarcode},data(){return{page_ready:false,drawer:false,menu_layout:"column",mobile_tab:"pos",category_id:"",category_data:[],category_loading:false,items_loading:true,items:true,attributes_loading:false,attributes_data:[],transaction_list:[],transaction_type:"",cart_transaction_type:"",modal_visible:true,payload:["items","merchant_info","service_fee","delivery_fee","packaging","tax","tips","checkout","discount","distance_local_new","summary","total","subtotal","items_count","points","points_discount"],items_count:0,cart_items:[],loading_cart:false,refresh_cart:false,cart_summary:[],cart_total:[],cart_error:[],cart_subtotal:[],customer_data:[],order_reference:"",pos_address:[],q:"",awaitingSearch:false,item_results:[],table_uuid:"",room_uuid:"",table_data:[],send_kds_loading:false,table_list:[],pos_edit_cart:false,total_sendorder:0,total_unsendorder:0,skip_kitchen:false,view:"new_view",view_list:[],do_search:false,table_status_loading:false,player:null,whento_deliver:"now",delivery_date:"",delivery_time:"",sidebar:false,sidebar_menu:[],points_data:null,customerID:null,modal_barcode:false,promoEligibility:{}}},created(){this.posAttributes();this.getTableStatus();this.BackofficeMenu()},mounted(){this.page_ready=true;let e=quasarComponents.getStorage("pos_menu_layout");if(!quasarComponents.empty(e)){this.menu_layout=e}this.CategoryList();this.initialCart();let t=quasarComponents.getStorage("pos_address");this.pos_address=!quasarComponents.empty(t)?t:"";let a=quasarComponents.getStorage("skip_kitchen");if(a){this.skip_kitchen=a}if(this.view!="new_view"){setTimeout(()=>{this.drawer=false},1e3)}},computed:{getOrderStatus(){if(Object.keys(this.attributes_data).length>0){return this.attributes_data.order_status_list}return[]},getDefaultCustomer(){if(Object.keys(this.attributes_data).length>0){return this.attributes_data.default_customer}return[]},whatsAppEnabled(){if(Object.keys(this.attributes_data).length>0){return this.attributes_data.whatsapp_enabled}return false},printerList(){if(Object.keys(this.attributes_data).length>0){if(Object.keys(this.attributes_data.printer_list).length>0){return this.attributes_data.printer_list}}return false},isTableEmpty(){if(quasarComponents.empty(this.table_uuid)){return true}return false},getRoomList(){if(Object.keys(this.attributes_data).length>0){return this.attributes_data.room_list}return[]},hasRooms(){if(Object.keys(this.attributes_data).length>0){if(Object.keys(this.attributes_data.room_list).length>0){return true}}return false},getTableList(){if(Object.keys(this.table_list).length>0){if(this.table_list[this.room_uuid]){return this.table_list[this.room_uuid]}}return[]},hasTableList(){if(Object.keys(this.table_list).length>0){if(this.table_list[this.room_uuid]){return true}}return false},getCategory(){return this.category_data},getItems(){return this.items},hasItems(){if(Object.keys(this.items).length>0){return true}return false},getTransactionList(){return this.attributes_data.transaction_list},hasCart(){if(Object.keys(this.cart_items).length>0){return true}return false},getCartItems(){return this.cart_items},isLoading(){if(this.loading_cart){return true}else{if(this.refresh_cart){return true}}return false},getSummary(){return this.cart_summary},customerSelected(){if(Object.keys(this.customer_data).length>0){return true}return false},hasAddress(){if(Object.keys(this.pos_address).length>0){return true}return false},getAddress(){if(Object.keys(this.pos_address).length>0){return this.pos_address}return false},isSearch(){if(!quasarComponents.empty(this.q)){return true}return false},searchResults(){if(Object.keys(this.item_results).length>0){return true}return false},hasCartError(){if(Object.keys(this.cart_error).length>0){return true}if(Object.keys(this.cart_items).length>0){if(Object.keys(this.customer_data).length<=0){return true}if(this.transaction_type=="delivery"){if(Object.keys(this.pos_address).length<=0){return true}}else if(this.transaction_type=="dinein"){if(quasarComponents.empty(this.table_uuid)){return true}}}return false},getCartError(){if(Object.keys(this.cart_error).length>0){return this.cart_error}let e=[];if(Object.keys(this.cart_items).length>0){if(Object.keys(this.customer_data).length<=0){e.push(translationVendor.please_select_customer);return e}if(this.transaction_type=="delivery"){if(Object.keys(this.pos_address).length<=0){e.push(translationVendor.delivery_address_required);return e}}else if(this.transaction_type=="dinein"){if(quasarComponents.empty(this.table_uuid)){e.push(translationVendor.table_number_required);return e}}}return false},hasTabledata(){if(Object.keys(this.table_data).length>0){return true}return false},isEdit(){return this.pos_edit_cart},isChangeTransaction(){if(this.cart_transaction_type){if(this.cart_transaction_type!=this.transaction_type){return true}}return false},isNeedtosendorder(){if(this.total_unsendorder>0){return true}return false},getOpeningDates(){let a=[];if(Object.keys(this.attributes_data).length>0){Object.entries(this.attributes_data.opening_hours.dates).forEach(([e,t])=>{a.push({label:t.name,value:t.value})});return a}return a},getTimelist(){if(Object.keys(this.attributes_data).length>0){if(!quasarComponents.empty(this.attributes_data.opening_hours.time_ranges[this.delivery_date])){return this.attributes_data.opening_hours.time_ranges[this.delivery_date]}}return[]},isBarcodeactive(){return this.attributes_data?.enabled_barcode??false}},watch:{q(e,t){if(!this.awaitingSearch){if(quasarComponents.empty(e)){return false}this.view="new_view";setTimeout(()=>{let e="q="+this.q;axios.post(pos_api+"/searchfooditems?language="+language,e,headerAuthorization).then(e=>{if(e.data.code==1){this.item_results=e.data.details.data}else{this.item_results=[]}})["catch"](e=>{console.error("Error:",e)}).then(e=>{this.awaitingSearch=false})},1e3)}this.item_results=[];this.awaitingSearch=true}},methods:{onselectCustomer(e){console.log("onselectCustomer",e);this.customerID=e},BackofficeMenu(){axios({method:"GET",url:ajaxurl+"/backofficemenu?language="+language,data:{},headers:{Authorization:`token ${token}`}}).then(e=>{if(e.data.code==1){this.sidebar_menu=e.data.details}else{this.sidebar_menu=[]}})["catch"](e=>{}).then(e=>{})},updateDeliveryDate(){this.delivery_time=""},getCartUUID(){let e=quasarComponents.getStorage("pos_cart_uuid");return!quasarComponents.empty(e)?e:""},getLocalID(){let e=quasarComponents.getStorage("pos_local_id");return!quasarComponents.empty(e)?e:""},posAttributes(){this.attributes_loading=true;axios({method:"GET",url:pos_api+"/posAttributes?language="+language,data:{},headers:{Authorization:`token ${token}`}}).then(t=>{if(t.data.code==1){this.attributes_data=t.data.details;let e=quasarComponents.getStorage("pos_transaction_type");this.transaction_type=!quasarComponents.empty(e)?e:this.attributes_data.transaction_type;Object.entries(this.attributes_data.transaction_list).forEach(([e,t])=>{this.transaction_list.push({label:t.service_name,value:t.service_code})});if(Object.keys(t.data.details.room_list).length>0){const[a]=Object.keys(t.data.details.room_list);this.room_uuid=a}this.view_list=t.data.details.view_list}else{this.attributes_data=[]}})["catch"](e=>{}).then(e=>{this.attributes_loading=false})},setMenuLayout(){this.menu_layout=this.menu_layout=="column"?"grid":"column";quasarComponents.setStorage("pos_menu_layout",this.menu_layout)},CategoryList(){this.category_loading=true;axios({method:"GET",url:pos_api+"/CategoryList?language="+language,data:{},headers:{Authorization:`token ${token}`}}).then(e=>{if(e.data.code==1){this.category_data=e.data.details.data;this.category_id=e.data.details.data[0].cat_id;this.categoryItems()}else{this.items=[];this.items_loading=false}})["catch"](e=>{}).then(e=>{this.category_loading=false})},loadItems(e){this.category_id=e;this.categoryItems()},categoryItems(){this.items_loading=true;axios({method:"GET",url:pos_api+"/categoryItems?language="+language+"&cat_id="+this.category_id,headers:{Authorization:`token ${token}`}}).then(e=>{if(e.data.code==1){this.items=e.data.details.data}})["catch"](e=>{}).then(e=>{this.items_loading=false})},afterCreatecustomer(e){this.$refs.customer_search.customer_name=e.data;this.customer_data=e},afterSelectcustomer(e){console.log("afterSelectcustomer",e);this.customer_data=e;this.refreshCart()},clearSelectcustomer(){this.customer_data=[];this.pos_address=[];quasarComponents.setStorage("pos_address","")},clearAddress(){console.log("clearAddress");this.pos_address=[];quasarComponents.setStorage("pos_address","")},initialCart(){let e=this.getCartUUID();let t=this.getLocalID();let a=quasarComponents.getStorage("pos_payload");a=a?a:null;let s=quasarComponents.getStorage("pos_edit_cart");this.pos_edit_cart=s;this.GetCart(e,t,a,false)},refreshCart(){let e=this.getCartUUID();let t=this.getLocalID();let a=quasarComponents.getStorage("pos_payload");a=a?a:null;this.GetCart(e,t,a,true)},GetCart(e,t,a,s){this.loading_cart=s?false:true;this.$refs.bar.start();const r={cart_uuid:!quasarComponents.empty(e)?e:"",local_id:!quasarComponents.empty(t)?t:"",payload:!quasarComponents.empty(a)?a:this.payload};axios.post(pos_api+"/getCart?language="+language,r,{headers:{Authorization:`token ${token}`}}).then(e=>{let t=e.data;if(e.data.code==1){this.items_count=t.details.items_count;this.cart_items=t.details.data.items;this.cart_summary=t.details.data.summary;this.cart_total=t.details.data.total;this.cart_error=t.details.error;this.cart_subtotal=t.details.data.subtotal;this.customer_data=t.details.customer_data;this.order_reference=t.details.order_reference;this.points_data=t.details.points_data;this.transaction_type=t.details.checkout_data.transaction_type;this.cart_transaction_type=t.details.checkout_data.transaction_type;if(Object.keys(t.details.customer_data).length>0){this.$refs.customer_search.customer_name=t.details.customer_data.data[0];this.onselectCustomer(t.details.customer_data.id)}this.table_data=t.details.table_data;this.total_sendorder=t.details.total_sendorder;this.total_unsendorder=t.details.total_unsendorder;this.pos_address=t.details.address_component;let e=t.details.checkout_data?t.details.checkout_data.data:[];console.log("checkout_data",e);this.whento_deliver=e.whento_deliver;this.delivery_date=e.delivery_date;this.delivery_time=e.delivery_time}else{this.cart_error=[];this.items_count=0;this.cart_uuid="";this.cart_items=[];this.cart_summary=[];this.cart_total=[];this.error=[];this.cart_subtotal=[];this.customer_data=[];this.order_reference="";this.points_data=null;if(t.details){this.table_data=t.details.table_data;if(!quasarComponents.empty(t.details.customer_data)){this.onselectCustomer(t.details.customer_data.value);this.$refs.customer_search.customer_name=t.details.customer_data}}}if(this.table_data.table_uuid){this.table_uuid=this.table_data.table_uuid}else{this.table_uuid=""}let a=quasarComponents.getStorage("pos_cart_uuid");if(quasarComponents.empty(a)){quasarComponents.setStorage("pos_cart_uuid",e.data.details.cart_uuid)}if(this.$q.screen.lt.sm){}else{this.drawer=true}})["catch"](e=>{console.error("Error:",e)}).then(e=>{this.loading_cart=false;this.refresh_cart=false;this.$refs?.bar?.stop()});this.promoCheck()},async promoCheck(){try{const e=new URLSearchParams({cart_uuid:this.getCartUUID()}).toString();const t=await axios.get(`${pos_api}/PromoCheck?${e}`,headerAuthorization);if(t.data.code==1){this.promoEligibility=t.data.details.data}else{this.promoEligibility=[]}}catch(error){}},setTransactionType(t){if(Object.keys(this.cart_items).length>0){if(this.pos_edit_cart){}else{this.$refs.bar.start();let e=this.getCartUUID();axios.post(pos_api+"/setTransactionType?language="+language,"cart_uuid="+e+"&transaction_type="+t,{headers:{Authorization:`token ${token}`}}).then(e=>{if(e.data.code==1){this.refreshCart()}})["catch"](e=>{console.error("Error:",e)}).then(e=>{this.$refs?.bar?.stop()})}}else{quasarComponents.setStorage("pos_transaction_type",t);if(t=="dinein"){this.getTableStatus()}}},viewItems(e){const t=this.isEligible(e);if(!t){quasarComponents.notify("myerror",this.getPromoMessage(e),"error");return}this.$refs.item_details.item_data={item_uuid:e.item_uuid,cat_id:this.category_id};this.$refs.item_details.dialog=true},afterAddtocart(){console.log("afterAddtocart");this.playScan();this.refreshCart()},afterAddguestnumber(){this.view="new_view";if(this.transaction_type!="dinein"){this.transaction_type="dinein"}this.refreshCart()},itemShow(){console.log("itemShow");this.modal_visible=false},itemHide(){console.log("itemHide");this.modal_visible=true},lessCartQty(e,t){e--;if(e>0){this.updateCartQty(e,t)}else{this.removeCartItem(t.cart_row)}},addCartQty(e,t){e++;this.updateCartQty(e,t)},updateCartQty(e,t){this.refresh_cart=true;let a="cart_uuid="+this.getCartUUID()+"&row="+t.cart_row+"&item_qty="+e;axios.post(pos_api+"/updateCartItems?language="+language,a,headerAuthorization).then(e=>{if(e.data.code==1){this.playScan();this.refreshCart()}else{quasarComponents.notify("myerror",e.data.msg,"error")}})["catch"](e=>{console.error("Error:",e)}).then(e=>{this.refresh_cart=false})},removeCartItem(e){this.refresh_cart=true;let t="cart_uuid="+this.getCartUUID()+"&row="+e;axios.post(pos_api+"/removeCartItem?language="+language,t,headerAuthorization).then(e=>{if(e.data.code==1){this.refreshCart()}else{quasarComponents.notify("myerror",e.data.msg,"error")}})["catch"](e=>{console.error("Error:",e)}).then(e=>{this.refresh_cart=false})},resetConfirm(){this.$q.dialog({title:translationVendor.clear_all_items,message:translationVendor.are_you_sure,transitionShow:"fade",transitionHide:"fade",cancel:true,ok:{unelevated:true,color:"primary",rounded:true,"text-color":"white",size:"md",label:translationVendor.confirm,"no-caps":true},cancel:{unelevated:true,color:"grey-5","text-color":"white",rounded:true,outline:false,size:"md",label:translationVendor.cancel,"no-caps":true}}).onOk(()=>{this.DeleteCart()})},DeleteCart(){this.$refs.bar.start();let e="cart_uuid="+this.getCartUUID();axios.post(pos_api+"/clearCart?language="+language,e,headerAuthorization).then(e=>{if(e.data.code==1){quasarComponents.setStorage("pos_address","");this.resetCart()}else{quasarComponents.notify("myerror",e.data.msg,"error")}})["catch"](e=>{console.error("Error:",e)}).then(e=>{this.$refs.bar.stop()})},resetCart(){this.whento_deliver="now";this.delivery_time="";this.delivery_date="";this.address_data=[];this.pos_address=[];this.customer_data=[];this.$refs.customer_search.customer_name="";quasarComponents.setStorage("pos_local_id","");quasarComponents.setStorage("pos_address","");quasarComponents.setStorage("pos_cart_uuid","");quasarComponents.setStorage("pos_payload","");quasarComponents.setStorage("pos_edit_cart",false);this.payload=this.payload.filter(e=>e!=="all_orders");this.total_unsendorder=0;this.total_sendorder=0;this.cart_transaction_type="";this.view="new_view";this.pos_edit_cart=false;this.refreshCart();this.getTableStatus()},showNewaddress(){this.$refs.new_address.modal=true},afterSaveaddress(e){console.log("afterSaveaddress",e);this.pos_address=e;this.refreshCart()},removePromocode(){this.$refs.bar.start();let e="cart_uuid="+quasarComponents.getStorage("pos_cart_uuid");axios.post(pos_api+"/removePromocode?language="+language,e,headerAuthorization).then(e=>{if(e.data.code==1){this.refreshCart()}else{quasarComponents.notify("myerror",e.data.msg,"error")}})["catch"](e=>{console.error("Error:",e)}).then(e=>{this.$refs.bar.stop()})},removeTips(){this.$refs.bar.start();let e="cart_uuid="+quasarComponents.getStorage("pos_cart_uuid");axios.post(pos_api+"/removeTips?language="+language,e,headerAuthorization).then(e=>{if(e.data.code==1){this.refreshCart()}else{quasarComponents.notify("myerror",e.data.msg,"error")}})["catch"](e=>{console.error("Error:",e)}).then(e=>{this.$refs.bar.stop()})},removePoints(){this.$refs.bar.start();let e="cart_uuid="+quasarComponents.getStorage("pos_cart_uuid");axios.post(pos_api+"/removePoints?language="+language,e,headerAuthorization).then(e=>{if(e.data.code==1){this.refreshCart()}else{quasarComponents.notify("myerror",e.data.msg,"error")}})["catch"](e=>{console.error("Error:",e)}).then(e=>{this.$refs.bar.stop()})},async afterHoldcart(e){this.resetCart();const t=e?.wifi_printers||null;const s=e?.cart_uuid;const a=await globalPrint.ConnectToPrintServer();console.log("connected",a);if(!a){quasarComponents.notify("myerror",globalPrint.socket_error,"error");return}if(t&&t.length>0){t.forEach(e=>{let t="printer_id="+e.printer_id;t+="&cart_uuid="+s;console.log("postData",t);const a=quasarComponents.dialog(translationVendor.printing+"<br/>"+translationVendor.close_window);axios.post(pos_api+"/wifiPrintOT?language="+language,t,headerAuthorization).then(async e=>{if(e.data.code==1){const t=await globalPrint.sendServerToPrinter(e.data.details.data);console.log("printResponse",t);if(t){quasarComponents.notify("mysuccess",e.data.msg,"info")}else{const a=translationVendor.websocket_is_not_open+globalPrint.webSocket.readyState;quasarComponents.notify("myerror",a,"error")}}else{quasarComponents.notify("myerror",e.data.msg,"error")}})["catch"](e=>{console.error("Error:",e)}).then(e=>{a.hide()})})}},afterDeleteorders(){console.log("afterDeleteorders");this.resetCart()},afterPayment(e){console.log("afterPayment",e);this.resetCart();this.$refs.choose_receipt.order_uuid=e.order_uuid;this.$refs.choose_receipt.email_address=e.email_address;this.$refs.choose_receipt.mobile_number=e.contact_phone;this.$refs.choose_receipt.order_id=e.order_id;this.$refs.choose_receipt.success_message=e.success_message;this.$refs.choose_receipt.modal=true;const t=e.wifi_printers||null;console.log("wifi_printers",t);if(t&&t.length>0){t.forEach(e=>{this.$refs.choose_receipt.wifiPrint(e.printer_id)})}},showSelectGuestNumber(e){console.log("data",e);if(e.cart_uuid){if(Object.keys(this.cart_items).length>0){quasarComponents.notify("myerror",translationVendor.table_not_available,"error")}else{this.payload.push("all_orders");quasarComponents.setStorage("pos_cart_uuid",e.cart_uuid);quasarComponents.setStorage("pos_payload",this.payload);quasarComponents.setStorage("pos_edit_cart",true);this.pos_edit_cart=true;this.GetCart(e.cart_uuid,null,this.payload,null)}}else{this.$refs.selectable.table_details=e;this.$refs.selectable.modal=true}},editTable(){console.log("editTable",this.table_data);this.showSelectGuestNumber(this.table_data)},SendToKitchen(){this.send_kds_loading=true;const t=this.$q.dialog({message:translationVendor.sending_orders,progress:true,persistent:true,ok:false});let e="cart_uuid="+this.getCartUUID();e+="&table_number="+this.table_uuid;e+="&transaction_type="+this.transaction_type;e+="&client_id="+(this.customer_data?this.customer_data.id:"");e+="&whento_deliver="+this.whento_deliver;e+="&delivery_date="+this.delivery_date;e+="&delivery_time="+this.delivery_time;axios.post(pos_api+"/SendToKitchen?language="+language,e,headerAuthorization).then(e=>{if(e.data.code==1){quasarComponents.notify("mysuccess",e.data.msg,"info");this.resetCart()}else{quasarComponents.notify("myerror",e.data.msg,"error")}})["catch"](e=>{console.error("Error:",e)}).then(e=>{this.send_kds_loading=false;t.hide()})},getTableStatus(){this.table_status_loading=true;axios.post(pos_api+"/getTableStatus?language="+language,"",headerAuthorization).then(e=>{if(e.data.code==1){this.table_list=e.data.details.table_list}else{this.table_list=[]}})["catch"](e=>{console.error("Error:",e)}).then(e=>{this.table_status_loading=false})},getStatusClass(e){return"table-"+e},closeOrder(){this.resetCart()},UpdateTransactions(){const t=this.$q.dialog({message:"Updating orders",progress:true,persistent:true,ok:false});let e="cart_uuid="+this.getCartUUID();e+="&transaction_type="+this.transaction_type;e+="&cart_transaction_type="+this.cart_transaction_type;axios.post(pos_api+"/UpdateTransactions?language="+language,e,headerAuthorization).then(e=>{if(e.data.code==1){quasarComponents.notify("mysuccess",e.data.msg,"info")}else{quasarComponents.notify("myerror",e.data.msg,"error")}})["catch"](e=>{console.error("Error:",e)}).then(e=>{t.hide()})},isNeedtosendorders(){if(this.total_unsendorder>0){return true}return false},MakePayment(){console.log("MakePayment",this.skip_kitchen);if(this.isNeedtosendorders()&&!this.skip_kitchen){this.$q.dialog({"class":"myowndialog",title:"Confirm",message:"<span class='text-body2'>"+translationVendor.unabled_to_pay+".</span>"+"<br/><br/><span class='text-body2 text-weight-bold'>"+translationVendor.clear_items+"</span>",html:true,cancel:true,persistent:true,ok:{unelevated:true,color:"green",rounded:false,"text-color":"white",label:translationVendor["continue"],"no-caps":true,"class":"btn-width-normal"},cancel:{unelevated:true,color:"grey","text-color":"grey-7",outline:true,rounded:false,label:translationVendor.cancel,"no-caps":true,"class":"btn-width-normal"}}).onOk(()=>{this.clearNewitems()}).onCancel(()=>{}).onDismiss(()=>{})}else{console.log("makepayment");this.$refs.makepayment.modal=true}},clearNewitems(){const t=quasarComponents.dialog(translationVendor.clearing_items);let e="cart_uuid="+this.getCartUUID();axios.post(pos_api+"/clearNewitems?language="+language,e,headerAuthorization).then(e=>{if(e.data.code==1){this.initialCart()}else{quasarComponents.notify("myerror",e.data.msg,"error")}})["catch"](e=>{console.error("Error:",e)}).then(e=>{t.hide()})},onSelectSkipkitchen(e){console.log("onSelectSkipkitchen",e);quasarComponents.setStorage("skip_kitchen",e)},removeTable(){console.log("removeTable");this.table_uuid="";this.table_data=[]},updateView(e){console.log("updateView",e);if(e=="new_view"){if(this.$q.screen.lt.sm){this.drawer=false}else this.drawer=true}else this.drawer=false;switch(e){case"table_view":this.getTableStatus();break}},loadOrders(e){console.log("loadOrders",e);let t=this.payload;t.push("all_orders");quasarComponents.setStorage("pos_cart_uuid",e.cart_uuid);quasarComponents.setStorage("pos_payload",t);quasarComponents.setStorage("pos_edit_cart",true);this.pos_edit_cart=true;this.view="new_view";this.GetCart(e.cart_uuid,null,t,null)},deleteConfirm(){this.$q.dialog({title:translationVendor.confirm_deletion,message:translationVendor.delete_records_confirm,transitionShow:"fade",transitionHide:"fade",cancel:true,ok:{unelevated:true,color:"primary",rounded:true,"text-color":"white",size:"md",label:translationVendor.yes,"no-caps":true},cancel:{unelevated:true,color:"grey-5","text-color":"white",rounded:true,outline:false,size:"md",label:translationVendor.cancel,"no-caps":true}}).onOk(()=>{this.deleteOrders()})},deleteOrders(){const t=quasarComponents.dialog(translationVendor.deleting_records);let e="cart_uuid="+this.getCartUUID();axios.post(pos_api+"/deleteOrders?language="+language,e,headerAuthorization).then(e=>{if(e.data.code==1){this.resetCart()}else{quasarComponents.notify("myerror",error,"error")}})["catch"](e=>{console.error("Error:",e)}).then(e=>{t.hide()})},webPrint(e){console.log("webPrint",e);this.$refs.receipt.order_uuid=e;this.$refs.receipt.modal=true},closeSearch(){this.do_search=false;this.q=""},beforeShowaddress(){console.log("beforeShowaddress",this.customer_data.id);if(this.customer_data.id>0){this.$refs.address_list.dialog=true}else{this.$refs.new_address.modal=true}},playAlert(){this.player=new Howl({src:["../assets/sound/notify.mp3","../assets/sound/notify.ogg"],html5:true});this.player.play()},onAlertactions(t){console.log("onAlertactions",t);switch(t.notification_type){case"order":case"request_bill":let e=this.payload;e.push("viewed");e.push("all_orders");quasarComponents.setStorage("pos_cart_uuid",t.cart_uuid);quasarComponents.setStorage("pos_payload",e);quasarComponents.setStorage("pos_edit_cart",true);this.pos_edit_cart=true;this.view="new_view";this.GetCart(t.cart_uuid,null,e,null);break;case"call_staff":console.log("request_id",t.request_id);this.view="table_request";break;case"table_payment":window.parent.location.href=t.url;break}},afterReceivenotification(e){console.log("afterReceivenotification",e);const t=e?e.notification_type:null;console.log("notification_type",t);console.log("view",this.view);if(t=="call_staff"&&this.view=="table_request"){this.$refs.request_list.getCustomerRequest()}else if(t=="order"&&this.view=="order_view"){this.$refs.ref_order_list.getPOSorders(null)}else if(t=="table_payment"&&this.view=="order_view"){this.$refs.ref_order_list.getPOSorders(null)}},OpenParentLink(e){console.debug("OpenParentLink",e);window.parent.location.href=e},showScanbarcode(){this.$refs.ref_barcode.modal=true},playScan(){this.player=new Howl({src:["../assets/sound/scan.mp3"],html5:true});this.player.play()},afterScan(e){this.playScan();this.$refs.item_details.item_data={item_uuid:e.item_uuid,cat_id:e.cat_id};this.$refs.item_details.dialog=true},testPrint(){console.log("testPrint");this.$q.dialog({title:translationVendor.confirm_test_print,message:translationVendor.test_print_message+"\n"+translationVendor.test_print_message_ready,transitionShow:"fade",transitionHide:"fade",cancel:true,ok:{unelevated:true,color:"primary",rounded:true,"text-color":"white",size:"md",label:translationVendor.submit,"no-caps":true},cancel:{unelevated:true,color:"grey-5","text-color":"white",rounded:true,outline:false,size:"md",label:translationVendor.cancel,"no-caps":true}}).onOk(()=>{this.testPrintWifi()})},async testPrintWifi(){const e=await globalPrint.ConnectToPrintServer();if(!e){quasarComponents.notify("myerror",globalPrint.socket_error,"error");return}try{const t=await axios.get(`${pos_api}/testPrintWifi?language=${language}`,headerAuthorization);if(t.data.code==1){const a=await globalPrint.sendServerToPrinter(t.data.details.data);console.log("printResponse",a);if(a){quasarComponents.notify("mysuccess",t.data.msg,"info")}else{const s=translationVendor.websocket_is_not_open+globalPrint.webSocket.readyState;quasarComponents.notify("myerror",s,"error")}}else{quasarComponents.notify("myerror",t.data.msg,"error")}}catch(error){console.error("GET failed:",error.message||error)}},getPromoMessage(e){return this.promoEligibility[e.item_id]?.message||e?.promo_data?.message},isEligible(e){if(!e?.promo_data?.message){return true}return this.promoEligibility[e.item_id]?.is_eligible||false}}});app_pos.use(Quasar,{config:{screen:{},notify:{},loadingBar:{skipHijack:true},loading:{},ripple:{}}});app_pos.mount("#app-pos");
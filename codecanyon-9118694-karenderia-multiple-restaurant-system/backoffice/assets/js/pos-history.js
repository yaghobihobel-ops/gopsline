const quasarComponents={empty(e){if(typeof e==="undefined"||e===null||e===""||e==="null"||e==="undefined"){return true}return false},setStorage(e,t){try{Quasar.LocalStorage.set(e,t)}catch(r){console.debug(r)}},getStorage(e){return Quasar.LocalStorage.getItem(e)},notify(e,t,r){const a=Quasar.Notify;a.create({message:t,color:e,icon:r,iconColor:e,classes:"primevue_toats",position:"bottom",html:true,timeout:3e3,multiLine:false,actions:[{noCaps:true,color:"white",handler:()=>{}}]})},dialog(e){const t=Quasar.Dialog;const r=t.create({message:e,progress:true,persistent:true,ok:false,html:true});return r}};const headerAuthorization={headers:{Authorization:`token ${token}`}};const translationVendor=!quasarComponents.empty(translation_vendor)?JSON.parse(translation_vendor):null;const ComponentsSearchcustomer={emits:["update:filter_customer"],data(){return{customer_name:"",loading:false,old_search:"",options:[],translationVendor:[]}},mounted(){this.getInitialCustomer();this.translationVendor=translationVendor},methods:{getInitialCustomer(){axios({method:"GET",url:pos_api+"/getInitialCustomer?language="+language,data:{},headers:{Authorization:`token ${token}`}}).then(e=>{if(e.data.code==1){this.options=e.data.details.data}else{this.options=[]}})["catch"](e=>{}).then(e=>{})},searchCustomer(e,t,r){if(e.length<2){if(!quasarComponents.empty(this.customer_name)){t(()=>{});return}this.old_search="";this.loading=false;t(()=>{});return}if(this.loading==e){t(()=>{})}this.loading=true;setTimeout(()=>{t(()=>{this.options=[];axios({method:"GET",url:pos_api+"/searchCustomer?language="+language+"&q="+e,data:{},headers:{Authorization:`token ${token}`}}).then(e=>{if(e.data.code==1){this.options=e.data.details.data}else{this.options=[]}})["catch"](e=>{}).then(e=>{this.loading=false})})},300)},onSelect(e){if(typeof e!=="undefined"&&e!==null){console.log("onSelect",e.label);this.$emit("update:filter_customer",e.label)}}},template:`		
    <q-select 
    v-model="customer_name" 
    :options="options"
    :label="translationVendor.customer" 
    emit-valuex
    map-options
    @filter="searchCustomer"	
    @update:model-value="onSelect"    
    use-input
    clearable
    >
    </q-select>
    `};const ComponentsSendReceipt={template:"#xchoose_receipt",props:["title","enabled_email","enabled_whatsapp","enabled_webprint","enabled_print"],data(){return{modal:false,email_address:"",mobile_number:"",order_uuid:""}},computed:{ValidEmail(){const e=this.email_address;const t=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return t.test(e)},ValidMobileNumber(){const e=this.mobile_number;const t=/^\+?[0-9]{10,}$/;return t.test(e)}},methods:{isValidEmail(e){const t=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return t.test(e)},isValidMobileNumber(e){const t=/^\+?[0-9]{10,}$/;return t.test(e)},sendReceipt(e){const t=quasarComponents.dialog(translationVendor.sending_receipt+"<br/>"+translationVendor.close_window);let r="sending_type="+e+"&email_address="+this.email_address+"&mobile_number="+this.mobile_number;r+="&order_uuid="+this.order_uuid;axios.post(pos_api+"/sendReceipt?language="+language,r,headerAuthorization).then(e=>{if(e.data.code==1){this.modal=false;quasarComponents.notify("mysuccess",e.data.msg,"info")}else{quasarComponents.notify("myerror",e.data.msg,"error")}})["catch"](e=>{console.error("Error:",e)}).then(e=>{t.hide()})}}};const ComponentsReceipt={template:"#xtemplate_receipt",data(){return{modal:false,loading:false,order_uuid:"",payload:["merchant_info","items","summary","order_info","status_allowed_cancelled","order_delivery_status"],merchant:[],order_info:[],order_items:[],order_summary:[],services:[],order_table_data:[],is_printing:false}},computed:{hasBooking(){if(Object.keys(this.order_table_data).length>0){return true}return false}},methods:{beforeShow(){this.orderDetails()},orderDetails(){this.loading=true;let e={order_uuid:this.order_uuid,payload:this.payload};axios.post(pos_api+"/orderDetails?language="+language,e,headerAuthorization).then(t=>{if(t.data.code==1){let e=t.data.details.data;this.merchant=e.merchant;this.order_info=e.order.order_info;this.order_items=e.items;this.order_summary=e.summary;this.services=e.order.services;this.order_table_data=e.order_table_data}else{quasarComponents.notify("myerror",t.data.msg,"error")}})["catch"](e=>{console.error("Error:",e)}).then(e=>{this.loading=false})},printReceipt(){this.is_printing=true;$(".printhis").printThis();setTimeout(()=>{this.is_printing=false},1e3)}}};const app_pos=Vue.createApp({components:{"components-searchcustomer":ComponentsSearchcustomer,"components-send-receipt":ComponentsSendReceipt,"components-receipt":ComponentsReceipt},data(){return{order_type:null,drawer:false,q:"",loading:false,rows:[],rowPerPageLabel:translationVendor.record_per_page,paginationLabel:(e,t,r)=>`${e}-${t} ${translationVendor.oflabel} ${r}`,columns:[{name:"order_id",field:"order_id",label:translationVendor.table_order_id,align:"left",sortable:true},{name:"order_type",field:"order_type",label:translationVendor.table_order_type,sortable:true,align:"left"},{name:"customer_name",field:"customer_name",label:translationVendor.table_customer,sortable:false,align:"left"},{name:"total",field:"total",label:translationVendor.table_amount,sortable:true},{name:"date_created",field:"date_created",label:translationVendor.table_date,sortable:true,align:"center"},{name:"status",field:"status",label:translationVendor.table_status,sortable:true}],rows:[],pagination:{sortBy:"order_id",descending:true,page:1,rowsPerPage:10,rowsNumber:50},filters:[],attributes_data:[],awaitingSearch:false,order_uuid:null,payload:["items","summary","order_info"],order_details:[],order_details_loading:false,filterDate:"",filter_date:{},calendarProxy:false,filter_order_status:"",filter_customer:"",filter_proxy:false,socket_error:"",webSocket:null,calendarLocale:{days:translationVendor.calendar_days,daysShort:translationVendor.calendar_short_days,months:translationVendor.calendar_months,monthsShort:translationVendor.calendar_short_months,firstDayOfWeek:1,format24h:true,pluralDay:translationVendor.days}}},mounted(){this.getAttributes()},computed:{printerList(){if(Object.keys(this.attributes_data).length>0){if(Object.keys(this.attributes_data.printer_list).length>0){return this.attributes_data.printer_list}}return false},getTabList(){if(Object.keys(this.attributes_data).length>0){return this.attributes_data.tab_list}return[]},getStatusList(){if(Object.keys(this.attributes_data).length>0){return this.attributes_data.order_status_list}return[]},getStatusListValue(){if(Object.keys(this.attributes_data).length>0){return this.attributes_data.order_status_list_value}return[]},hasData(){if(Object.keys(this.rows).length>0){return true}return false},isSearch(){if(!quasarComponents.empty(this.q)){return true}return false},hasOrderDetails(){if(Object.keys(this.order_details).length>0){return true}return false},getOrderInfo(){if(Object.keys(this.order_details).length>0){return this.order_details.order.order_info}return false},getOrderItems(){if(Object.keys(this.order_details).length>0){return this.order_details.items}return false},getOrderSummary(){if(Object.keys(this.order_details).length>0){return this.order_details.summary}return false},getOrderCustomer(){if(Object.keys(this.order_details).length>0){return this.order_details.customer}return false},hasFilters(){if(Object.keys(this.filters).length>0){return true}return false}},watch:{q(e,t){if(!this.awaitingSearch){if(quasarComponents.empty(e)){return false}setTimeout(()=>{this.filters={order_type:this.order_type,q:this.q}},1e3)}this.awaitingSearch=true}},methods:{resetFilters(){this.filters=[];this.filterDate="";this.filter_order_status=""},initFilterDate(){const e=luxon.DateTime.local();const t=e;const r=e.minus({days:7});const a=t.toFormat("yyyy/MM/dd");const s=r.toFormat("yyyy/MM/dd");console.log("Start Date:",a);console.log("End Date:",s);this.filter_date={from:s,to:a};this.filterDate=this.filter_date.from+" - "+this.filter_date.to},rangeEnded(){this.calendarProxy=false},updateRangevalue(e){if(typeof e!=="undefined"&&e!==null){this.filterDate=e.from+" - "+e.to}else{this.filterDate=""}},clearSearch(){this.q="";this.filters={order_type:this.order_type,q:this.q}},getAttributes(){axios({method:"GET",url:pos_api+"/Orderhistoryattributes?language="+language,data:{},headers:{Authorization:`token ${token}`}}).then(e=>{if(e.data.code==1){this.order_type=e.data.details.first_tab;this.attributes_data=e.data.details}else{this.attributes_data=[]}this.$refs.tableRef.requestServerInteraction()})["catch"](e=>{}).then(e=>{})},updateOrderList(e){this.filters={order_type:e}},onRowClick(e){this.getOrderDetails(e.order_uuid)},onRequest(e){const{page:t,rowsPerPage:r,sortBy:a,descending:s}=e.pagination;let o=e.filter;const i=r===0?pagination.rowsNumber:r;const n=(t-1)*r;this.loading=true;if(o.length<=0){o={order_type:this.order_type||"all"}}let l={startRow:n,fetchCount:i,filter:o,sortBy:a,descending:s};axios.post(pos_api+"/PosOrders?language="+language,l,headerAuthorization).then(e=>{if(e.data.code==1){this.order_uuid=e.data.details.order_uuid;this.rows=e.data.details.data;this.pagination.rowsNumber=e.data.details.total;this.getOrderDetails(this.order_uuid)}else{this.rows=[]}this.pagination.page=t;this.pagination.rowsPerPage=r;this.pagination.sortBy=a;this.pagination.descending=s})["catch"](e=>{console.error("Error:",e)}).then(e=>{this.loading=false;this.awaitingSearch=false})},getOrderDetails(e){this.$refs.bar.start();this.order_details_loading=true;let t={order_uuid:e,payload:this.payload};axios.post(pos_api+"/orderDetails?language="+language,t,headerAuthorization).then(e=>{if(e.data.code==1){this.order_details=e.data.details.data}else{this.order_details=[]}})["catch"](e=>{console.error("Error:",e)}).then(e=>{this.order_details_loading=false;this.$refs.bar.stop()})},applyFilters(){console.log("applyFilters");this.filters={filter_order_status:this.filter_order_status,filter_customer:this.filter_customer,filter_date:this.filter_date};this.filter_proxy=false},getLabel(t){if(Object.keys(this.attributes_data).length>0){const e=this.attributes_data.tab_list.find(e=>e.value===t);return e?e.label:""}},viewOrder(){console.log("getOrderInfo.view_order_link",this.getOrderInfo.view_order_link);window.parent.location.href=this.getOrderInfo.view_order_link},chooseReceipt(){console.log("chooseReceipt",this.getOrderInfo);this.$refs.choose_receipt.order_uuid=this.getOrderInfo.order_uuid;this.$refs.choose_receipt.email_address=this.getOrderInfo.contact_email;this.$refs.choose_receipt.mobile_number=this.getOrderInfo.contact_number;this.$refs.choose_receipt.modal=true},webPrint(){this.$refs.receipt.order_uuid=this.getOrderInfo.order_uuid;this.$refs.receipt.modal=true},SwitchPrinter(e,t){if(t=="feieyun"){this.printUsingThermal(e)}else{this.wifiPrint(e)}},printUsingThermal(e){const t=quasarComponents.dialog(translationVendor.printing+"<br/>"+translationVendor.close_window);let r="printer_id="+e;r+="&order_uuid="+this.getOrderInfo.order_uuid;axios.post(pos_api+"/printUsingThermal?language="+language,r,headerAuthorization).then(e=>{if(e.data.code==1){this.modal=false;quasarComponents.notify("mysuccess",e.data.msg,"info")}else{quasarComponents.notify("myerror",e.data.msg,"error")}})["catch"](e=>{console.error("Error:",e)}).then(e=>{t.hide()})},wifiPrint(e){const t=quasarComponents.dialog(translationVendor.printing+"<br/>"+translationVendor.close_window);let r="printer_id="+e;r+="&order_uuid="+this.getOrderInfo.order_uuid;axios.post(pos_api+"/wifiPrint?language="+language,r,headerAuthorization).then(e=>{if(e.data.code==1){this.ConnectToPrintServer();setTimeout(()=>{this.sendServerToPrinter(e.data.details.data,e.data.msg)},500)}else{quasarComponents.notify("myerror",e.data.msg,"error")}})["catch"](e=>{console.error("Error:",e)}).then(e=>{t.hide()})},ConnectToPrintServer(){let e=!quasarComponents.empty(printerServer)?printerServer:null;if(this.webSocket==null){console.log("CONNECT ConnectToPrintServer");this.webSocket=new WebSocket(e);this.webSocket.onopen=function(e){console.log("WebSocket is open now.")};this.webSocket.onmessage=function(e){console.log("Received message from server:",e.data)};this.webSocket.onclose=function(e){console.log("WebSocket is closed now.");this.webSocket=null};this.webSocket.onerror=e=>{this.webSocket=null;this.socket_error=translationVendor.websocket_error;if(e instanceof ErrorEvent){this.socket_error=e.message}}}},sendServerToPrinter(e,t){if(this.webSocket.readyState===WebSocket.OPEN){this.webSocket.send(JSON.stringify(e));quasarComponents.notify("mysuccess",t,"info")}else{if(quasarComponents.empty(this.socket_error)){this.socket_error=translationVendor.websocket_is_not_open+this.webSocket.readyState}quasarComponents.notify("myerror",this.socket_error,"error")}}}});app_pos.use(Quasar,{config:{screen:{},notify:{},loadingBar:{skipHijack:true},loading:{},ripple:{}}});app_pos.mount("#app-pos");
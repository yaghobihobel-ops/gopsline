# GOOPS Execution Runbook – 7-Task Delivery Flow

این راهنما برای اجرای مرحله‌به‌مرحله هفت اپیک تعریف‌شده در `GOOPS_EXECUTION_PLAN_7_TASKS.md` تهیه شده است. هر بخش شامل پیش‌نیازها، گام‌های اجرایی پیشنهادی، کنترل کیفیت و خروجی‌های قابل تحویل است تا تیم‌ها بتوانند بدون دوباره‌کاری پیش بروند. قبل از شروع هر تسک، آخرین نسخه اسناد (`ANALYSIS.md`, `ROADMAP.md`, `TEST_SCENARIOS.md`, `FINAL_CHECKLIST.md`, `QA_EVALUATION.md`, `GOOPS_SYSTEM_MAP.md`, `GOOPS_DOMAIN_OVERVIEW.md`) مرور و با وضعیت تیم‌ها هماهنگ شود.

## Task 1 – زیرساخت سرویس‌های خارجی و لایه‌های انتزاعی
**Preconditions:**
- تکمیل مطالعه تحلیل سیستم، معماری و ریسک‌های سرویس‌های خارجی.
- در اختیار بودن کلیدهای تست نشان، سرویس پیامک ایرانی و سرویس realtime منتخب.
- موافقت تیم DevOps با معماری کش و لاگ مرکزی.

**Execution Steps:**
1. ایجاد دایرکتوری‌های سرویس انتزاعی در بک‌اند (مثلاً `protected/components/providers/`).
2. طراحی اینترفیس‌های `MapProviderInterface`, `SmsProviderInterface`, `RealtimeProviderInterface`, `CacheServiceInterface`, `CentralLoggerInterface`.
3. پیاده‌سازی نمونه‌های اولیه (`NeshanMapProvider`, آداپتور پیامک ایرانی، گزینه realtime) همراه با ثبت در Container یا Service Locator موجود.
4. افزودن صفحه تنظیمات در پنل ادمین (`protected/views/admin/settings/`) برای مدیریت کلیدها و وضعیت سرویس‌ها.
5. مستندسازی نحوه افزودن Provider جدید در پوشه `docs/` یا بخش مربوط در `GOOPS_EXECUTION_PLAN_7_TASKS.md`.
6. راه‌اندازی محیط تست با Mock برای مواقع قطعی سرویس‌های بومی.

**QA & Verification:**
- اجرای تست‌های یکپارچه برای هر Provider با استفاده از کلیدهای Sandbox.
- بررسی لاگ مرکزی جهت تضمین ثبت رویدادهای مهم (پرداخت، سفارش، اعلان).
- تایید تیم امنیت بر مدیریت کلیدها.

**Deliverables:**
- کد سرویس‌های انتزاعی + مستند پیکربندی.
- داشبورد اولیه مانیتورینگ و فایل راه‌اندازی Providerها.
- صورتجلسه تایید DevOps و بک‌اند بر معماری نهایی.

## Task 2 – ماژول نقشه و مناطق سرویس‌دهی در کلاینت‌ها
**Preconditions:**
- دسترسی به `MapProvider` و کلیدهای نشان از Task 1.
- هم‌راستایی روی مدل Zone/Polygon با بک‌اند.
- تعیین مسئول برای هر اپ (MobileVue، MerchantVue، DriverVue، KitchenMobile).

**Execution Steps:**
1. ایجاد لایه wrapper برای نقشه در هر اپ (`src/components/map/NeshanMap.vue` یا معادل).
2. جایگزینی وابستگی `vue3-google-map` با wrapper جدید و حذف پیکربندی‌های گوگل.
3. همگام‌سازی APIهای Zone/Polygon با بک‌اند؛ به‌روزرسانی سرویس‌های داده (`src/services/zone.ts`).
4. پیاده‌سازی fallback آفلاین و lazy-loading برای اسکریپت نقشه.
5. مستندسازی فرآیند هماهنگی مختصات (از جمله تبدیل‌ها و validate در فرم‌ها).
6. تدوین تست‌های تعاملی (Playwright/Cypress) برای سناریوهای انتخاب آدرس، جابه‌جایی پین و نمایش محدوده.

**QA & Verification:**
- بررسی رندر نقشه در دیوایس‌های هدف (Android, iOS, وب دسکتاپ).
- تایید عملکرد CRUD مناطق سرویس از سوی تیم پشتیبانی.
- مرور سناریوهای نقشه در `TEST_SCENARIOS.md` و علامت‌گذاری موارد پوشش‌داده‌شده.

**Deliverables:**
- کامپوننت نقشه نشان در تمام اپ‌ها.
- مستند هماهنگ‌سازی Zone/Polygon.
- تست‌های خودکار و گزارش سازگاری دستگاه‌ها.

## Task 3 – پرداخت زرین‌پال، مغایرت‌ها و گزارش تسویه
**Preconditions:**
- سرویس لاگ مرکزی و کش از Task 1 فعال باشد.
- قرارداد و دسترسی Sandbox/Production زرین‌پال دریافت شده باشد.
- خروجی ساختار سفارش‌ها و وضعیت‌های مالی با تیم مالی تایید شده باشد.

**Execution Steps:**
1. ایجاد ماژول زرین‌پال در بک‌اند (`protected/modules/payment/zarinpal/`).
2. پیاده‌سازی کنترلر و سرویس‌های callback، تایید پرداخت، پیگیری خطا.
3. افزودن Migration دیتابیس برای ستون‌های گزارش و وضعیت‌های جدید.
4. اتصال به سرویس لاگ مرکزی برای ثبت تراکنش‌ها و رخدادهای failure.
5. تهیه گزارش‌های مالی در پنل ادمین (گزارش‌های CSV/Excel با تاریخ شمسی).
6. نوشتن مستند خطایابی پرداخت و تعامل با تیم مالی.

**QA & Verification:**
- اجرای تست‌های end-to-end پرداخت در حالت موفق، لغو، timeout.
- بررسی مطابقت گزارش‌ها با داده پایگاه داده و تاریخ شمسی.
- مانیتورینگ لاگ‌های مرکزی برای هشدارهای پرداخت.

**Deliverables:**
- ماژول زرین‌پال آماده انتشار و مستند راه‌اندازی.
- گزارش‌های مالی و داشبورد تسویه.
- طرح مدیریت خطا و Playbook عملیات برای تیم مالی.

## Task 4 – منطق سفارش، موجودی و پشتیبانی از مامان‌ها
**Preconditions:**
- نقشه و پرداخت از Tasks 2 و 3 پایدار باشند.
- KPIهای داشبورد مامان با تیم محصول نهایی شده باشد.
- فرآیند شکایات مورد تایید پشتیبانی.

**Execution Steps:**
1. بازنگری مدل سفارش در بک‌اند برای محاسبه و قفل `stock`.
2. توسعه ماژول شکایات (مدل، کنترلر، UI در پنل و اپ مامان).
3. پیاده‌سازی داشبورد مامان با نمودارهای روزانه و فیلتر تاریخ شمسی.
4. طراحی فرآیند آنبوردینگ مامان با چک‌لیست مدارک و وضعیت پیشرفت.
5. بروزرسانی اسناد سفر مشتری/مامان و هماهنگی با پشتیبانی.
6. اجرای تست پذیرش با گروهی از مامان‌ها و مشتریان آزمایشی.

**QA & Verification:**
- تست سناریوهای سفارش پیچیده (لغو، بازپرداخت، چند سفارش همزمان).
- بررسی رضایت تیم پشتیبانی از ماژول شکایات.
- تایید داشبورد مامان با داده واقعی (یا داده seed).

**Deliverables:**
- منطق سفارش و موجودی جدید با تست‌های واحد.
- ماژول شکایات و داشبورد مامان.
- اسناد آموزش مامان‌ها و پشتیبان‌ها.

## Task 5 – بومی‌سازی نهایی زبان، تومان، شمسی و UX
**Preconditions:**
- تغییرات محصولی و فلوهای مامان/مشتری از Task 4 تثبیت شده باشند.
- فایل‌های متنی و ایمیل جمع‌آوری شده باشد.
- تصمیم درباره ساختار چندزبانه (فایل JSON یا سرویس) گرفته شده باشد.

**Execution Steps:**
1. ممیزی واحد پول در تمام کانال‌ها و اعمال Formatter تومان در بک‌اند و فرانت.
2. افزودن کتابخانه/فیلتر تاریخ شمسی به همه اپ‌ها و ایمیل‌ها.
3. راه‌اندازی سیستم ترجمه چندزبانه در Quasar (مثلاً `src/i18n/fa/index.ts`).
4. اصلاح سبک‌های RTL و بازبینی UI صفحات کلیدی.
5. مستندسازی لحن پیام‌ها، سناریوهای اعلان و هماهنگی با تیم محتوا.
6. اجرای بازبینی محتوایی با QA برای تضمین سازگاری.

**QA & Verification:**
- تست snapshot برای UIهای RTL و تاریخ شمسی.
- بررسی ترجمه‌ها توسط تیم محتوا و پشتیبانی.
- اعتبارسنجی Formatter تومان در گزارش‌های مالی و اعلان‌ها.

**Deliverables:**
- فایل‌های ترجمه و تنظیمات RTL نهایی.
- راهنمای سبک محتوا و واحد پول.
- گزارش تست بومی‌سازی و لیست صفحات تایید شده.

## Task 6 – تضمین کیفیت، تست‌های E2E و آماده‌سازی لانچ
**Preconditions:**
- خروجی‌های Tasks 1–5 در محیط staging در دسترس باشند.
- ابزار تست (Playwright/Cypress) و CI/CD آماده باشد.
- تیم QA برنامه‌ریزی سناریوها را تایید کرده باشد.

**Execution Steps:**
1. به‌روزرسانی `TEST_SCENARIOS.md` با سناریوهای جدید (پرداخت، نقشه، شکایات، بومی‌سازی).
2. نوشتن تست‌های E2E برای جریان‌های اصلی مشتری و مامان.
3. افزودن تست‌های API/Integration برای Providerها و پرداخت.
4. تنظیم اجرای خودکار در CI و ایجاد گزارش با روند خطا.
5. انجام تست رگرسیون دستی طبق `FINAL_CHECKLIST.md` و ثبت نتایج.
6. برگزاری جلسه Go/No-Go با حضور تیم محصول، QA، عملیات.

**QA & Verification:**
- تمام تست‌های خودکار باید در CI سبز باشند.
- خروجی `QA_EVALUATION.md` به‌روزرسانی شود و ریسک‌های باقیمانده مشخص گردد.
- نواقص بحرانی قبل از لانچ بسته شود.

**Deliverables:**
- مجموعه تست‌های خودکار در ریپو و گزارش‌های CI.
- نسخه به‌روز اسناد تست و چک‌لیست نهایی.
- مصوبه Go-Live یا برنامه رفع موانع.

## Task 7 – مستندسازی و تجربه توسعه‌دهنده (DX)
**Preconditions:**
- خروجی‌های فنی Tasks 1–6 آماده و قابل ارجاع باشند.
- مسئول مستندسازی و هماهنگی با تیم‌های محصول/QA مشخص شود.
- ساختار نهایی README و راهنماها تایید شده باشد.

**Execution Steps:**
1. به‌روزرسانی `GOOPS_SYSTEM_MAP.md`, `GOOPS_DOMAIN_OVERVIEW.md` و سایر اسناد Julius با دستاوردهای جدید.
2. تدوین راهنمای نصب و راه‌اندازی در ریشه ریپو (وابستگی‌ها، bootstrap دیتابیس، اجرای اپ‌ها).
3. مستندسازی تنظیمات سرویس‌ها (نشان، زرین‌پال، SMS، کش، realtime) در یک بخش واحد.
4. تعریف conventions جدید (نام‌گذاری استیت‌ها، ساختار پوشه‌ها، فرآیند pull request) و درج در `CONTRIBUTING.md` یا سند جدید.
5. ساخت FAQ برای تیم پشتیبانی/توسعه درباره جریان‌های بومی‌سازی.
6. جمع‌بندی نکات موردنیاز برای نگهداری آینده و قرار دادن در `ROADMAP.md`.

**QA & Verification:**
- مرور مستندات توسط نماینده هر تیم (بک‌اند، فرانت، QA، پشتیبانی).
- اطمینان از همخوانی نسخه‌های انگلیسی/فارسی در صورت وجود.
- بررسی لینک‌های داخلی و کد نمونه در اسناد.

**Deliverables:**
- بسته اسناد نهایی و README به‌روز.
- صفحه راهنمای تنظیمات سرویس‌ها.
- فایل conventions و FAQ برای توسعه‌دهندگان و عملیات.

## Cross-Task Coordination
- **Timeline پیشنهادی:** اجرای Tasks 1 و 7 (بخش اسناد پایه) در Sprint 1؛ Task 2 و 3 در Sprint 2؛ Task 4 و 5 در Sprint 3؛ Task 6 و نهایی‌سازی Task 7 در Sprint 4.
- **جلسات هماهنگی:**
  - استندآپ روزانه با تمرکز بر بلاکرهای Provider، نقشه، پرداخت.
  - Sync هفتگی بین بک‌اند، فرانت و QA برای به‌روزرسانی اسناد و سناریوها.
  - Go/No-Go جلسه نهایی پس از اتمام Task 6.
- **گزارش‌ دهی:** استفاده از بورد Kanban با ستون‌های «تحلیل»، «درحال اجرا»، «Code Review»، «Staging»، «Done». کارت‌ها مطابق کدهای FX-101 تا FX-705 از پیوست «Full Execution Board» ثبت شوند.

با پیروی از این Runbook، تیم می‌تواند فرایند بومی‌سازی و آماده‌سازی سامانه گُوپس را بدون حفره اجرایی پیش ببرد و خروجی‌های هر تسک را مطابق انتظار استیک‌هولدرها تحویل دهد.

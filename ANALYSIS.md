# فاز ۱: تحلیل و مستندسازی معماری پروژه گُوپس و مامان‌ها

این مستند، خروجی فاز اول پروژه برای تحلیل و بومی‌سازی اپلیکیشن **Karenderia** برای بازار ایران است.

---

## ۱.۱. شناسایی معماری و ساختار

معماری پروژه از چند لایه اصلی تشکیل شده است:

*   **Frontend (رابط کاربری):**
    *   **تکنولوژی:** [Quasar Framework](https://quasar.dev/) (مبتنی بر Vue.js).
    *   **توضیح:** برخلاف تصور اولیه که مبتنی بر فلاتر بود، اپلیکیشن‌های موبایل و وب با Quasar توسعه داده شده‌اند. این فریم‌ورک قابلیت خروجی گرفتن برای وب (SPA)، اپلیکیشن دسکتاپ (Electron)، اپلیکیشن موبایل هیبریدی (Capacitor/Cordova) و PWA را دارد.
    *   **نکات مثبت:** Quasar پشتیبانی بسیار خوبی از زبان‌های راست‌چین (RTL) دارد که فرآیند بومی‌سازی را ساده‌تر می‌کند.

*   **Backend (منطق سمت سرور):**
    *   **تکنولوژی:** [Yii Framework](https://www.yiiframework.com/) (یک فریم‌ورک PHP مبتنی بر الگوی MVC).
    *   **توضیح:** تمام منطق تجاری، مدیریت کاربران، سفارش‌ها، پرداخت‌ها و ارتباط با دیتابیس در این لایه پیاده‌سازی شده است. ساختار پوشه‌ها (models, views, controllers) استاندارد این فریم‌ورک است.

*   **API (رابط برنامه‌نویسی کاربردی):**
    *   **نقطه ورود:** `protected/controllers/ApiController.php`
    *   **توضیح:** اپلیکیشن‌های Quasar از طریق این API با بک‌اند ارتباط برقرار می‌کنند. تمام داده‌های مورد نیاز اپ‌ها (لیست رستوران‌ها، منوها، وضعیت سفارش و ...) از این طریق دریافت و ارسال می‌شود.

*   **Database (پایگاه داده):**
    *   **تکنولوژی:** MySQL / MariaDB.
    *   **توضیح:** ساختار کامل دیتابیس در فایل `karenderia.sql` موجود است. جداول به خوبی طراحی شده‌اند و از پیشوند `st_` استفاده می‌کنند. وجود جداول `_translation` نشان‌دهنده آمادگی سیستم برای چندزبانه شدن است.

*   **سرویس‌ها و اپلیکیشن‌ها (Monorepo):**
    1.  **سیستم اصلی (بک‌اند و پنل مدیریت):**
        *   **مکان:** `codecanyon-9118694-karenderia-multiple-restaurant-system/`
        *   **توضیح:** شامل کدهای PHP (فریم‌ورک Yii) و پنل مدیریت تحت وب در پوشه `backoffice/` است.
    2.  **اپلیکیشن مشتری:**
        *   **مکان:** `codecanyon-40502711-karenderia-mobile-app-multi-restaurant/MobileVue/`
        *   **تکنولوژی:** Quasar/Vue.js
    3.  **اپلیکیشن فروشنده (مامان‌ها):**
        *   **مکان:** `codecanyon-42215908-karenderia-merchant-app-restaurant/MobileVue/`
        *   **تکنولوژی:** Quasar/Vue.js
    4.  **اپلیکیشن راننده:**
        *   **مکان:** `codecanyon-44025705-karenderia-driver-app/MobileVue/`
        *   **تکنولوژی:** Quasar/Vue.js
    5.  **سیستم نمایش آشپزخانه (KDS):**
        *   **مکان:** `codecanyon-53130431-karenderia-kitchen-display-system/`
        *   **توضیح:** یک اپلیکیشن تحت وب برای نمایش سفارش‌ها در آشپزخانه.

---

## ۱.۲. جریان‌های کاربری اصلی (به صورت خلاصه)

*   **جریان مامان (فروشنده):**
    1.  **ثبت‌نام:** از طریق `MerchantController.php` و صفحه ثبت‌نام.
    2.  **انتخاب پلن:** انتخاب پلن اشتراک (ماهانه، سالانه و ...).
    3.  **پرداخت:** پرداخت هزینه پلن از طریق درگاه‌های موجود.
    4.  **ورود به پنل:** دسترسی به پنل مدیریت مامان‌ها (`backoffice/merchant/`) برای تعریف منو، مدیریت سفارش‌ها و مشاهده گزارش‌ها.

*   **جریان مشتری:**
    1.  **ورود/ثبت‌نام:** از طریق اپلیکیشن مشتری (Quasar) و `ApiController.php`.
    2.  **جستجوی رستوران:** بر اساس آدرس (با استفاده از سرویس نقشه) یا منطقه.
    3.  **انتخاب غذا و افزودن به سبد خرید:** تعامل با منوی رستوران در اپ.
    4.  **پرداخت:** از طریق `PaymentplanController.php` و ماژول‌های پرداخت.
    5.  **پیگیری سفارش:** مشاهده وضعیت لحظه‌ای سفارش در اپ.

*   **جریان مدیریت (ادمین):**
    1.  **ورود به پنل:** دسترسی به پنل اصلی مدیریت (`backoffice/`).
    2.  **مدیریت مامان‌ها:** تایید، رد یا مسدود کردن حساب مامان‌ها.
    3.  **گزارش‌گیری:** مشاهده گزارش‌های فروش، کمیسیون و ...
    4.  **تنظیمات:** مدیریت درگاه‌های پرداخت، سرویس نقشه، هزینه‌ها و ...

---

## ۱.۳. ریسک‌های معماری و نقاط ضعف

*   **وابستگی به سرویس‌های خارجی (ریسک بالا برای ایران):**
    *   **نقشه:** Google Maps (`vue3-google-map`) و Mapbox. این سرویس‌ها در ایران با محدودیت مواجه هستند و باید با جایگزین‌های ایرانی (مانند نشان یا بلد) تعویض شوند. (**نیاز به تغییر فوری**)
    *   **پرداخت:** Stripe, PayPal, Razorpay. این درگاه‌ها برای بازار ایران غیرقابل استفاده‌اند و باید با زرین‌پال جایگزین شوند. (**نیاز به تغییر فوری**)
    *   **احراز هویت:** Google Auth و Facebook Login. ممکن است نیاز به بررسی جایگزین یا استفاده از روش‌های داخلی (ایمیل/پیامک) باشد.
    *   **نوتیفیکیشن:** Firebase Cloud Messaging (FCM). در حال حاضر کار می‌کند اما ریسک محدودیت در آینده را دارد.

*   **ماژول‌های نیازمند بازبینی:**
    *   **ماژول تاریخ:** سیستم به طور کامل از تاریخ میلادی استفاده می‌کند. تبدیل آن به شمسی در بخش‌های گزارش‌گیری، فیلتر زمانی و نمایش سفارش‌ها ممکن است باعث بروز خطا در مرتب‌سازی (Sorting) و محاسبات شود. (**ریسک شکستن سیستم بالا**)
    *   **ماژول واحد پول:** محاسبات مالی بر اساس دلار انجام می‌شود. تبدیل به تومان/ریال باید با دقت بالا انجام شود تا از خطاهای گرد کردن (Rounding) جلوگیری شود. (**ریسک محاسبات اشتباه**)
    *   **مناطق سرویس‌دهی:** به نظر می‌رسد مناطق به صورت محدود و وابسته به سرویس نقشه تعریف شده‌اند و قابلیت تعریف چندضلعی (Polygon) برای مناطق در پنل ادمین وجود ندارد. این بخش باید توسعه داده شود.

*   **پوشش تست:**
    *   (فرض:) پروژه فاقد تست‌های خودکار (Unit/Integration Test) است. هرگونه تغییر در ماژول‌های حساس (پرداخت، تاریخ، نقشه) نیازمند تست دستی کامل خواهد بود.

---

## چک‌لیست کارهای بعدی (شروع فاز ۲)

1.  **ایجاد فایل‌های ترجمه فارسی:** شروع فرآیند استخراج متون و ترجمه آن‌ها.
2.  **بررسی کدهای مربوط به قیمت:** شناسایی تمام بخش‌هایی که قیمت را نمایش یا محاسبه می‌کنند.
3.  **بررسی کدهای مربوط به تاریخ:** شناسایی تمام بخش‌هایی که تاریخ را ذخیره یا نمایش می‌دهند.
4.  **فعال‌سازی RTL در Quasar:** انجام تنظیمات اولیه برای راست‌چین‌سازی.
5.  **طراحی لایه انتزاعی برای نقشه:** آماده‌سازی کد برای جایگزینی سرویس نقشه.
6.  **ایجاد ماژول پرداخت زرین‌پال:** شروع پیاده‌سازی درگاه پرداخت جدید.
